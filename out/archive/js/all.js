let showWatermark=0,godMode=0;const debug=0,debugOverlay=0,debugPhysics=0,debugParticles=0,debugRaycast=0,debugGamepads=0,debugMedals=0,ASSERT=()=>{},debugInit=()=>{},debugUpdate=()=>{},debugRender=()=>{},debugRect=()=>{},debugCircle=()=>{},debugPoint=()=>{},debugLine=()=>{},debugAABB=()=>{},debugText=()=>{},debugClear=()=>{},debugSaveCanvas=()=>{},PI=Math.PI,abs=e=>0>e?-e:e,min=(e,t)=>e<t?e:t,max=(e,t)=>e>t?e:t,sign=e=>0>e?-1:1,mod=(e,t=1)=>(e%t+t)%t,clamp=(e,t=0,i=1)=>e<t?t:e>i?i:e,percent=(e,t=0,i=1)=>i-t?clamp((e-t)/(i-t)):0,lerp=(e,t=0,i=1)=>t+clamp(e)*(i-t),smoothStep=e=>e*e*(3-2*e),nearestPowerOfTwo=e=>2**Math.ceil(Math.log2(e)),isOverlapping=(e,t,i,a)=>2*abs(e.x-i.x)<t.x+a.x&2*abs(e.y-i.y)<t.y+a.y,wave=(e=1,t=1,i=time)=>t/2*(1-Math.cos(i*e*2*PI)),formatTime=e=>(e/60|0)+":"+(10>e%60?"0":"")+(e%60|0),rand=(e=1,t=0)=>t+(e-t)*Math.random(),randInt=(e=1,t=0)=>0|rand(e,t),randSign=()=>2*(0|rand(2))-1,randInCircle=(e=1,t=0)=>0<e?randVector(e*rand(t/e,1)**.5):new Vector2,randVector=(e=1)=>(new Vector2).setAngle(rand(2*PI),e),randColor=(e=new Color,t=new Color(0,0,0,1),i)=>i?e.lerp(t,rand()):new Color(rand(e.r,t.r),rand(e.g,t.g),rand(e.b,t.b),rand(e.a,t.a));let randSeed=1;const randSeeded=(e=1,t=0)=>(randSeed^=randSeed<<13,randSeed^=randSeed>>>17,t+(e-t)*abs((randSeed^=randSeed<<5)%1e9)/1e9),vec2=(e=0,t)=>null==e.x?new Vector2(e,null==t?e:t):new Vector2(e.x,e.y);class Vector2{constructor(e=0,t=0){this.x=e,this.y=t}copy(){return new Vector2(this.x,this.y)}add(e){return ASSERT(null!=e.x),new Vector2(this.x+e.x,this.y+e.y)}subtract(e){return ASSERT(null!=e.x),new Vector2(this.x-e.x,this.y-e.y)}multiply(e){return ASSERT(null!=e.x),new Vector2(this.x*e.x,this.y*e.y)}divide(e){return ASSERT(null!=e.x),new Vector2(this.x/e.x,this.y/e.y)}scale(e){return ASSERT(null==e.x),new Vector2(this.x*e,this.y*e)}length(){return this.lengthSquared()**.5}lengthSquared(){return this.x**2+this.y**2}distance(e){return this.distanceSquared(e)**.5}distanceSquared(e){return(this.x-e.x)**2+(this.y-e.y)**2}normalize(e=1){const t=this.length();return t?this.scale(e/t):new Vector2(0,e)}clampLength(e=1){const t=this.length();return t>e?this.scale(e/t):this}dot(e){return ASSERT(null!=e.x),this.x*e.x+this.y*e.y}cross(e){return ASSERT(null!=e.x),this.x*e.y-this.y*e.x}angle(){return Math.atan2(this.x,this.y)}setAngle(e=0,t=1){return this.x=t*Math.sin(e),this.y=t*Math.cos(e),this}rotate(e){const t=Math.cos(e);return e=Math.sin(e),new Vector2(this.x*t-this.y*e,this.x*e+this.y*t)}direction(){return abs(this.x)>abs(this.y)?0>this.x?3:1:0>this.y?2:0}invert(){return new Vector2(this.y,-this.x)}floor(){return new Vector2(Math.floor(this.x),Math.floor(this.y))}area(){return abs(this.x*this.y)}lerp(e,t){return ASSERT(null!=e.x),this.add(e.subtract(this).scale(clamp(t)))}arrayCheck(e){return 0<=this.x&&0<=this.y&&this.x<e.x&&this.y<e.y}toString(e=3){return`(${(0>this.x?"":" ")+this.x.toFixed(e)},${(0>this.y?"":" ")+this.y.toFixed(e)} )`}}class Color{constructor(e=1,t=1,i=1,a=1){this.r=e,this.g=t,this.b=i,this.a=a}copy(){return new Color(this.r,this.g,this.b,this.a)}add(e){return new Color(this.r+e.r,this.g+e.g,this.b+e.b,this.a+e.a)}subtract(e){return new Color(this.r-e.r,this.g-e.g,this.b-e.b,this.a-e.a)}multiply(e){return new Color(this.r*e.r,this.g*e.g,this.b*e.b,this.a*e.a)}divide(e){return new Color(this.r/e.r,this.g/e.g,this.b/e.b,this.a/e.a)}scale(e,t=e){return new Color(this.r*e,this.g*e,this.b*e,this.a*t)}clamp(){return new Color(clamp(this.r),clamp(this.g),clamp(this.b),clamp(this.a))}lerp(e,t){return this.add(e.subtract(this).scale(clamp(t)))}setHSLA(e=0,t=0,i=1,a=1){i=2*i-(t=.5>i?i*(1+t):i+t-i*t);const s=(e,t,i)=>(i=(i%1+1)%1)<1/6?e+6*(t-e)*i:.5>i?t:i<2/3?e+(t-e)*(2/3-i)*6:e;return this.r=s(i,t,e+1/3),this.g=s(i,t,e),this.b=s(i,t,e-1/3),this.a=a,this}getHSLA(){const e=this.r,t=this.g,i=this.b,a=this.a,s=Math.max(e,t,i),n=Math.min(e,t,i),l=(s+n)/2;let o=0,r=0;if(s!=n){let a=s-n;r=.5<l?a/(2-s-n):a/(s+n),e==s?o=(t-i)/a+(t<i?6:0):t==s?o=(i-e)/a+2:i==s&&(o=(e-t)/a+4)}return[o/6,r,l,a]}mutate(e=.05,t=0){return new Color(this.r+rand(e,-e),this.g+rand(e,-e),this.b+rand(e,-e),this.a+rand(t,-t)).clamp()}toString(){return ASSERT(0<=this.r&&1>=this.r&&0<=this.g&&1>=this.g&&0<=this.b&&1>=this.b&&0<=this.a&&1>=this.a),`rgb(${255*this.r|0},${255*this.g|0},${255*this.b|0},${this.a})`}rgbaInt(){return ASSERT(0<=this.r&&1>=this.r&&0<=this.g&&1>=this.g&&0<=this.b&&1>=this.b&&0<=this.a&&1>=this.a),(255*this.r|0)+(255*this.g<<8)+(255*this.b<<16)+(255*this.a<<24)}setHex(e){return this.r=parseInt(e.slice(1,3),16)/255,this.g=parseInt(e.slice(3,5),16)/255,this.b=parseInt(e.slice(5,7),16)/255,this.a=1,ASSERT(0<=this.r&&1>=this.r&&0<=this.g&&1>=this.g&&0<=this.b&&1>=this.b),this}getHex(){const e=e=>(16>(e=255*e|0)?"0":"")+e.toString(16);return"#"+e(this.r)+e(this.g)+e(this.b)}}class Timer{constructor(e){this.time=null==e?void 0:time+e,this.setTime=e}set(e=0){this.time=time+e,this.setTime=e}unset(){this.time=void 0}isSet(){return null!=this.time}active(){return time<=this.time}elapsed(){return time>this.time}get(){return this.isSet()?time-this.time:0}getPercent(){return this.isSet()?percent(this.time-time,this.setTime,0):0}toString(){if(debug)return this.unset()?"unset":Math.abs(this.get())+" seconds "+(0>this.get()?"before":"after")}}let canvasMaxSize=vec2(1920,1200),canvasFixedSize=vec2(),cavasPixelated=1,fontDefault="arial",tileSizeDefault=vec2(16),tileFixBleedScale=.3,objectDefaultSize=vec2(1),enablePhysicsSolver=1,objectDefaultMass=1,objectDefaultDamping=.99,objectDefaultAngleDamping=.99,objectDefaultElasticity=0,objectDefaultFriction=.8,objectMaxSpeed=1,gravity=0,particleEmitRateScale=1,cameraPos=vec2(),cameraScale=max(tileSizeDefault.x,tileSizeDefault.y),glEnable=1,glOverlay=1,gamepadsEnable=1,gamepadDirectionEmulateStick=1,inputWASDEmulateDirection=1,touchGamepadEnable=0,touchGamepadAnalog=1,touchGamepadSize=80,touchGamepadAlpha=.3,vibrateEnable=1,soundVolume=.5,soundEnable=1,soundDefaultRange=30,soundDefaultTaper=.7,medalDisplayTime=5,medalDisplaySlideTime=.5,medalDisplayWidth=640,medalDisplayHeight=80,medalDisplayIconSize=50;const engineName="LittleJS",engineVersion="1.3.8",frameRate=60,timeDelta=1/frameRate;let engineObjects=[],engineObjectsCollide=[],frame=0,time=0,timeReal=0,paused=0,frameTimeLastMS=0,frameTimeBufferMS=0,tileImageSize,tileImageFixBleed,averageFPS,drawCount;const styleBody="margin:0;overflow:hidden;background:#000;touch-action:none;user-select:none;-webkit-user-select:none;-moz-user-select:none",styleCanvas="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)";function engineInit(e,t,i,a,s,n){tileImage.onerror=tileImage.onload=(()=>{tileImageFixBleed=vec2(tileFixBleedScale).divide(tileImageSize=vec2(tileImage.width,tileImage.height)),debug&&(tileImage.onload=(()=>ASSERT(1))),document.body.style=styleBody,document.body.appendChild(mainCanvas=document.createElement("canvas")),mainContext=mainCanvas.getContext("2d"),mainCanvas.style=styleCanvas,debugInit(),glInit(),document.body.appendChild(overlayCanvas=document.createElement("canvas")),overlayContext=overlayCanvas.getContext("2d"),overlayCanvas.style=styleCanvas,e(),touchGamepadCreate(),l()});const l=(e=0)=>{var n=e-frameTimeLastMS;if(frameTimeLastMS=e,(debug||showWatermark)&&(averageFPS=lerp(.05,averageFPS||0,1e3/(n||1))),debug&&(n*=keyIsDown(107)?5:keyIsDown(109)?.2:1),timeReal+=n/1e3,frameTimeBufferMS=min(frameTimeBufferMS+!paused*n,50),canvasFixedSize.x?(overlayCanvas.width=mainCanvas.width=canvasFixedSize.x,overlayCanvas.height=mainCanvas.height=canvasFixedSize.y,e=innerWidth/innerHeight,n=mainCanvas.width/mainCanvas.height,mainCanvas.style.width=overlayCanvas.style.width=e<n?"100%":"",mainCanvas.style.height=overlayCanvas.style.height=e<n?"":"100%",glCanvas&&(glCanvas.style.width=mainCanvas.style.width,glCanvas.style.height=mainCanvas.style.height)):(overlayCanvas.width=mainCanvas.width=min(innerWidth,canvasMaxSize.x),overlayCanvas.height=mainCanvas.height=min(innerHeight,canvasMaxSize.y)),mainCanvasSize=vec2(mainCanvas.width,mainCanvas.height),paused)inputUpdate(),debugUpdate(),i(),inputUpdatePost();else{for(e=0,0>frameTimeBufferMS&&-9<frameTimeBufferMS&&(e=frameTimeBufferMS,frameTimeBufferMS=0);0<=frameTimeBufferMS;frameTimeBufferMS-=1e3/frameRate)inputUpdate(),t(),engineObjectsUpdate(),debugUpdate(),i(),inputUpdatePost();frameTimeBufferMS+=e}for(var o of(enginePreRender(),a(),engineObjects.sort((e,t)=>e.renderOrder-t.renderOrder),engineObjects))o.destroyed||o.render();s(),medalsRender(),touchGamepadRender(),debugRender(),glCopyToContext(mainContext),showWatermark&&(overlayContext.textAlign="right",overlayContext.textBaseline="top",overlayContext.font="1em monospace",overlayContext.fillStyle="#000",o=engineName+" v"+engineVersion+" / "+drawCount+" / "+engineObjects.length+" / "+averageFPS.toFixed(1)+" "+(glEnable?"GL":"2D"),overlayContext.fillText(o,mainCanvas.width-3,3),overlayContext.fillStyle="#fff",overlayContext.fillText(o,mainCanvas.width-2,2),drawCount=0),requestAnimationFrame(l)};n?tileImage.src=n:tileImage.onload()}function enginePreRender(){mainCanvasSize=vec2(mainCanvas.width,mainCanvas.height),mainContext.imageSmoothingEnabled=!cavasPixelated,glPreRender(mainCanvas.width,mainCanvas.height,cameraPos.x,cameraPos.y,cameraScale)}function engineObjectsUpdate(){engineObjectsCollide=engineObjects.filter(e=>e.collideSolidObjects);const e=t=>{if(!t.destroyed){t.update();for(const i of t.children)e(i)}};for(const t of engineObjects)t.parent||e(t);engineObjects=engineObjects.filter(e=>!e.destroyed),time=++frame/frameRate}function engineObjectsDestroy(){for(const e of engineObjects)e.parent||e.destroy();engineObjects=engineObjects.filter(e=>!e.destroyed)}function engineObjectsCallback(e,t,i,a=engineObjects){if(e)if(null!=t.x)for(const s of a)isOverlapping(e,t,s.pos,s.size)&&i(s);else{t*=t;for(const s of a)e.distanceSquared(s.pos)<t&&i(s)}else for(const e of a)i(e)}class EngineObject{constructor(e=vec2(),t=objectDefaultSize,i=-1,a=tileSizeDefault,s=0,n,l=0){ASSERT(e&&null!=e.x&&null!=t.x),this.pos=e.copy(),this.size=t,this.drawSize,this.tileIndex=i,this.tileSize=a,this.angle=s,this.color=n,this.additiveColor,this.mass=objectDefaultMass,this.damping=objectDefaultDamping,this.angleDamping=objectDefaultAngleDamping,this.elasticity=objectDefaultElasticity,this.friction=objectDefaultFriction,this.gravityScale=1,this.renderOrder=l,this.velocity=new Vector2,this.angleVelocity=0,this.spawnTime=time,this.children=[],this.collideTiles=1,engineObjects.push(this)}update(){var e=this.parent;if(e)this.pos=this.localPos.multiply(vec2(e.getMirrorSign(),1)).rotate(-e.angle).add(e.pos),this.angle=e.getMirrorSign()*this.localAngle+e.angle;else if(this.velocity.x=clamp(this.velocity.x,-objectMaxSpeed,objectMaxSpeed),this.velocity.y=clamp(this.velocity.y,-objectMaxSpeed,objectMaxSpeed),e=this.pos.copy(),this.pos.x+=this.velocity.x*=this.damping,this.pos.y+=this.velocity.y=this.damping*this.velocity.y+gravity*this.gravityScale,this.angle+=this.angleVelocity*=this.angleDamping,ASSERT(0<=this.angleDamping&&1>=this.angleDamping),ASSERT(0<=this.damping&&1>=this.damping),enablePhysicsSolver&&this.mass){var t=0>this.velocity.y;if(this.groundObject){var i=this.groundObject.velocity?this.groundObject.velocity.x:0;this.velocity.x=i+(this.velocity.x-i)*this.friction,this.groundObject=0}if(this.collideSolidObjects)for(var a of engineObjectsCollide)if(!(!this.isSolid&!a.isSolid||a.destroyed||a.parent||a==this||!isOverlapping(this.pos,this.size,a.pos,a.size)||!this.collideWithObject(a)|!a.collideWithObject(this)))if(isOverlapping(e,this.size,a.pos,a.size)){var s=(i=e.subtract(a.pos)).length();i=.01>s?randVector(.001):i.scale(.001/s),this.velocity=this.velocity.add(i),a.mass&&(a.velocity=a.velocity.subtract(i)),debugOverlay&&debugPhysics&&debugAABB(this.pos,this.size,a.pos,a.size,"#f00")}else{i=this.size.add(a.size),s=2*(e.y-a.pos.y)>i.y+gravity;var n=2*abs(e.y-a.pos.y)<i.y,l=2*abs(e.x-a.pos.x)<i.x;if(s||l||!n)if(this.pos.y=a.pos.y+(i.y/2+.001)*sign(e.y-a.pos.y),a.groundObject&&t||!a.mass)t&&(this.groundObject=a),this.velocity.y*=-this.elasticity;else if(a.mass){const e=(this.mass*this.velocity.y+a.mass*a.velocity.y)/(this.mass+a.mass),t=this.velocity.y*(this.mass-a.mass)/(this.mass+a.mass)+2*a.velocity.y*a.mass/(this.mass+a.mass),i=a.velocity.y*(a.mass-this.mass)/(this.mass+a.mass)+2*this.velocity.y*this.mass/(this.mass+a.mass),s=max(this.elasticity,a.elasticity);this.velocity.y=lerp(s,e,t),a.velocity.y=lerp(s,e,i)}s||!n&&l||(this.pos.x=a.pos.x+(i.x/2+.001)*sign(e.x-a.pos.x),a.mass?(i=(this.mass*this.velocity.x+a.mass*a.velocity.x)/(this.mass+a.mass),s=this.velocity.x*(this.mass-a.mass)/(this.mass+a.mass)+2*a.velocity.x*a.mass/(this.mass+a.mass),n=a.velocity.x*(a.mass-this.mass)/(this.mass+a.mass)+2*this.velocity.x*this.mass/(this.mass+a.mass),l=max(this.elasticity,a.elasticity),this.velocity.x=lerp(l,i,s),a.velocity.x=lerp(l,i,n)):this.velocity.x*=-this.elasticity),debugOverlay&&debugPhysics&&debugAABB(this.pos,this.size,a.pos,a.size,"#f0f")}this.collideTiles&&tileCollisionTest(this.pos,this.size,this)&&!tileCollisionTest(e,this.size,this)&&(i=tileCollisionTest(new Vector2(e.x,this.pos.y),this.size,this),a=tileCollisionTest(new Vector2(this.pos.x,e.y),this.size,this),!i&&a||(this.groundObject=t,this.velocity.y*=-this.elasticity,0>(t=(e.y-this.size.y/2|0)-(e.y-this.size.y/2))&&t>this.damping*this.velocity.y+gravity*this.gravityScale&&(this.velocity.y=this.damping?(t-gravity*this.gravityScale)/this.damping:0),this.pos.y=e.y),a&&(this.pos.x=e.x,this.velocity.x*=-this.elasticity))}}render(){drawTile(this.pos,this.drawSize||this.size,this.tileIndex,this.tileSize,this.color,this.angle,this.mirror,this.additiveColor)}destroy(){if(!this.destroyed){this.destroyed=1,this.parent&&this.parent.removeChild(this);for(const e of this.children)e.destroy(e.parent=0)}}collideWithTile(e,t){return 0<e}collideWithTileRaycast(e,t){return 0<e}collideWithObject(e){return 1}getAliveTime(){return time-this.spawnTime}applyAcceleration(e){this.mass&&(this.velocity=this.velocity.add(e))}applyForce(e){this.applyAcceleration(e.scale(1/this.mass))}getMirrorSign(){return this.mirror?-1:1}addChild(e,t=vec2(),i=0){ASSERT(!e.parent&&!this.children.includes(e)),this.children.push(e),e.parent=this,e.localPos=t.copy(),e.localAngle=i}removeChild(e){ASSERT(e.parent==this&&this.children.includes(e)),this.children.splice(this.children.indexOf(e),1),e.parent=0}setCollision(e=0,t=0,i=1){ASSERT(e||!t),this.collideSolidObjects=e,this.isSolid=t,this.collideTiles=i}toString(){if(debug){let e="type = "+this.constructor.name;return(this.pos.x||this.pos.y)&&(e+="\npos = "+this.pos),(this.velocity.x||this.velocity.y)&&(e+="\nvelocity = "+this.velocity),(this.size.x||this.size.y)&&(e+="\nsize = "+this.size),this.angle&&(e+="\nangle = "+this.angle.toFixed(3)),this.color&&(e+="\ncolor = "+this.color),e}}}const tileImage=new Image;let mainCanvas,mainContext,overlayCanvas,overlayContext,mainCanvasSize=vec2();const screenToWorld=e=>(ASSERT(mainCanvasSize.x&&mainCanvasSize.y,"mainCanvasSize is invalid"),e.add(vec2(.5)).subtract(mainCanvasSize.scale(.5)).multiply(vec2(1/cameraScale,-1/cameraScale)).add(cameraPos)),worldToScreen=e=>(ASSERT(mainCanvasSize.x&&mainCanvasSize.y,"mainCanvasSize is invalid"),e.subtract(cameraPos).multiply(vec2(cameraScale,-cameraScale)).add(mainCanvasSize.scale(.5)).subtract(vec2(.5)));function drawTile(e,t=vec2(1),i=-1,a=tileSizeDefault,s=new Color,n=0,l,o=new Color(0,0,0,0),r=glEnable){if(showWatermark&&++drawCount,glEnable&&r)if(0>i||!tileImage.width)glDraw(e.x,e.y,t.x,t.y,n,0,0,0,0,0,s.rgbaInt());else{var c=tileImageSize.x/a.x|0;r=a.x/tileImageSize.x;const h=a.y/tileImageSize.y,d=i%c*r;c=(i/c|0)*h,glDraw(e.x,e.y,l?-t.x:t.x,t.y,n,d+tileImageFixBleed.x,c+tileImageFixBleed.y,d-tileImageFixBleed.x+r,c-tileImageFixBleed.y+h,s.rgbaInt(),o.rgbaInt())}else drawCanvas2D(e,t,n,l,e=>{if(0>i)e.fillStyle=s,e.fillRect(-.5,-.5,1,1);else{var t=tileImageSize.x/a.x|0;const n=i%t*a.x+tileFixBleedScale;t=(i/t|0)*a.y+tileFixBleedScale;const l=a.x-2*tileFixBleedScale,o=a.y-2*tileFixBleedScale;e.globalAlpha=s.a,e.drawImage(tileImage,n,t,l,o,-.5,-.5,1,1)}})}function drawRect(e,t,i,a,s){drawTile(e,t,-1,tileSizeDefault,i,a,0,0,s)}function drawTileScreenSpace(e,t=vec2(1),i,a,s,n,l,o,r){drawTile(screenToWorld(e),t.scale(1/cameraScale),i,a,s,n,l,o,r)}function drawRectScreenSpace(e,t,i,a,s){drawTileScreenSpace(e,t,-1,tileSizeDefault,i,a,0,0,s)}function drawLine(e,t,i=.1,a,s){t=vec2((t.x-e.x)/2,(t.y-e.y)/2),i=vec2(i,2*t.length()),drawRect(e.add(t),i,a,t.angle(),0,0,s)}function drawCanvas2D(e,t,i,a,s,n=mainContext){e=worldToScreen(e),t=t.scale(cameraScale),n.save(),n.translate(e.x+.5|0,e.y-.5|0),n.rotate(i),n.scale(a?-t.x:t.x,t.y),s(n),n.restore()}function setBlendMode(e,t=glEnable){glEnable&&t?glSetBlendMode(e):mainContext.globalCompositeOperation=e?"lighter":"source-over"}function drawTextScreen(e,t,i=1,a=new Color,s=0,n=new Color(0,0,0),l="center",o=fontDefault){overlayContext.fillStyle=a,overlayContext.lineWidth=s,overlayContext.strokeStyle=n,overlayContext.textAlign=l,overlayContext.font=i+"px "+o,overlayContext.textBaseline="middle",overlayContext.lineJoin="round",t=t.copy(),(e+"").split("\n").forEach(e=>{s&&overlayContext.strokeText(e,t.x,t.y),overlayContext.fillText(e,t.x,t.y),t.y+=i})}function drawText(e,t,i=1,a,s,n,l,o){drawTextScreen(e,worldToScreen(t),i*cameraScale,a,s*cameraScale,n,l,o)}let engineFontImage;class FontImage{constructor(e,t=vec2(8),i=vec2(0,1),a=0,s=overlayContext){e||engineFontImage||((engineFontImage=new Image).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAAYAQAAAAA9+x6JAAAAAnRSTlMAAHaTzTgAAAGiSURBVHjaZZABhxxBEIUf6ECLBdFY+Q0PMNgf0yCgsSAGZcT9sgIPtBWwIA5wgAPEoHUyJeeSlW+gjK+fegWwtROWpVQEyWh2npdpBmTUFVhb29RINgLIukoXr5LIAvYQ5ve+1FqWEMqNKTX3FAJHyQDRZvmKWubAACcv5z5Gtg2oyCWE+Yk/8JZQX1jTTCpKAFGIgza+dJCNBF2UskRlsgwitHbSV0QLgt9sTPtsRlvJjEr8C/FARWA2bJ/TtJ7lko34dNDn6usJUMzuErP89UUBJbWeozrwLLncXczd508deAjLWipLO4Q5XGPcJvPu92cNDaN0P5G1FL0nSOzddZOrJ6rNhbXGmeDvO3TF7DeJWl4bvaYQTNHCTeuqKZmbjHaSOFes+IX/+IhHrnAkXOAsfn24EM68XieIECoccD4KZLk/odiwzeo2rovYdhvb2HYFgyznJyDpYJdYOmfXgVdJTaUi4xA2uWYNYec9BLeqdl9EsoTw582mSFDX2DxVLbNt9U3YYoeatBad1c2Tj8t2akrjaIGJNywKB/7h75/gN3vCMSaadIUTAAAAAElFTkSuQmCC"),this.image=e||engineFontImage,this.tileSize=t,this.paddingSize=i,this.startTileIndex=a,this.context=s}drawTextScreen(e,t,i=4,a){const s=this.context;s.save(),s.imageSmoothingEnabled=!cavasPixelated;const n=this.tileSize,l=n.add(this.paddingSize).scale(i),o=this.image.width/this.tileSize.x|0;e.split("\n").forEach((e,r)=>{const c=a?e.length*n.x*i/2|0:0;for(let a=e.length;a--;){var h=e[a].charCodeAt();(32>h||127<h)&&(h=127);var d=this.startTileIndex+h-32;h=d%o,d=d/o|0;const g=t.add(vec2(a,r).multiply(l));s.drawImage(this.image,h*n.x,d*n.y,n.x,n.y,g.x-c,g.y,n.x*i,n.y*i)}}),s.restore()}drawText(e,t,i=1,a){this.drawTextScreen(e,worldToScreen(t).floor(),i*cameraScale|0,a)}}const isFullscreen=()=>document.fullscreenElement;function toggleFullscreen(){isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen():document.body.webkitRequestFullScreen?document.body.webkitRequestFullScreen():document.body.mozRequestFullScreen&&document.body.mozRequestFullScreen()}const keyIsDown=(e,t=0)=>inputData[t]&&1&inputData[t][e]?1:0,keyWasPressed=(e,t=0)=>inputData[t]&&2&inputData[t][e]?1:0,keyWasReleased=(e,t=0)=>inputData[t]&&4&inputData[t][e]?1:0,clearInput=()=>inputData=[[]],mouseIsDown=keyIsDown,mouseWasPressed=keyWasPressed,mouseWasReleased=keyWasReleased;let mousePos=vec2(),mousePosScreen=vec2(),mouseWheel=0,isUsingGamepad=0,preventDefaultInput=0;const gamepadIsDown=(e,t=0)=>keyIsDown(e,t+1),gamepadWasPressed=(e,t=0)=>keyWasPressed(e,t+1),gamepadWasReleased=(e,t=0)=>keyWasReleased(e,t+1),gamepadStick=(e,t=0)=>stickData[t]&&stickData[t][e]||vec2();let inputData=[[]];function inputUpdate(){document.hasFocus()||clearInput(),mousePos=screenToWorld(mousePosScreen),gamepadsUpdate()}function inputUpdatePost(){for(const e of inputData)for(const t in e)e[t]&=1;mouseWheel=0}onkeydown=(e=>{debug&&e.target!=document.body||(e.repeat||(inputData[isUsingGamepad=0][remapKeyCode(e.keyCode)]=3),preventDefaultInput&&e.preventDefault())}),onkeyup=(e=>{debug&&e.target!=document.body||(inputData[0][remapKeyCode(e.keyCode)]=4)});const remapKeyCode=e=>inputWASDEmulateDirection?87==e?38:83==e?40:65==e?37:68==e?39:e:e;onmousedown=(e=>{inputData[isUsingGamepad=0][e.button]=3,onmousemove(e),e.button&&e.preventDefault()}),onmouseup=(e=>inputData[0][e.button]=2&inputData[0][e.button]|4),onmousemove=(e=>mousePosScreen=mouseToScreen(e)),onwheel=(e=>e.ctrlKey||(mouseWheel=sign(e.deltaY))),oncontextmenu=(e=>!1);const mouseToScreen=e=>{if(!mainCanvas)return vec2();const t=mainCanvas.getBoundingClientRect();return vec2(mainCanvas.width,mainCanvas.height).multiply(vec2(percent(e.x,t.left,t.right),percent(e.y,t.top,t.bottom)))},stickData=[];function gamepadsUpdate(){if(touchGamepadEnable&&touchGamepadTimer.isSet()){(stickData[0]||(stickData[0]=[]))[0]=vec2(touchGamepadStick.x,-touchGamepadStick.y);for(var e=inputData[1]||(inputData[1]=[]),t=10;t--;){var i=3==t?2:2==t?3:t;e[i]=touchGamepadButtons[t]?1+2*!gamepadIsDown(i,0):4*gamepadIsDown(i,0)}}if(gamepadsEnable&&navigator.getGamepads&&(document.hasFocus()||debug))for(t=(e=navigator.getGamepads()).length;t--;){var a=e[t];const l=inputData[t+1]||(inputData[t+1]=[]);if(i=stickData[t]||(stickData[t]=[]),a){for(var s=e=>.3<e?percent(e,.3,.8):-.3>e?-percent(-e,.3,.8):0,n=0;n<a.axes.length-1;n+=2)i[n>>1]=vec2(s(a.axes[n]),s(-a.axes[n+1])).clampLength();for(s=a.buttons.length;s--;)n=a.buttons[s],l[s]=n.pressed?1+2*!gamepadIsDown(s,t):4*gamepadIsDown(s,t),isUsingGamepad|=!t&&n.pressed,touchGamepadEnable&&touchGamepadTimer.unset();gamepadDirectionEmulateStick&&((a=vec2(gamepadIsDown(15,t)-gamepadIsDown(14,t),gamepadIsDown(12,t)-gamepadIsDown(13,t))).lengthSquared()&&(i[0]=a.clampLength()))}}}const vibrate=e=>vibrateEnable&&Navigator.vibrate&&Navigator.vibrate(e),vibrateStop=()=>vibrate(0),isTouchDevice=void 0!==window.ontouchstart;if(isTouchDevice){let e,t;ontouchstart=ontouchmove=ontouchend=(i=>{i.button=0;const a=i.touches.length;return a?(t||zzfx(0,t=1),i.x=i.touches[0].clientX,i.y=i.touches[0].clientY,e?onmousemove(i):onmousedown(i)):e&&onmouseup(i),e=a,!i.cancelable})}let touchGamepadTimer=new Timer,touchGamepadButtons=[],touchGamepadStick=vec2();function touchGamepadCreate(){touchGamepadEnable&&isTouchDevice&&(ontouchstart=ontouchmove=ontouchend=(e=>{if(touchGamepadEnable){if(touchGamepadStick=vec2(),touchGamepadButtons=[],e.touches.length&&(touchGamepadTimer.isSet()||zzfx(0),isUsingGamepad=1,touchGamepadTimer.set(),paused))return void(touchGamepadButtons[9]=1);var t=vec2(touchGamepadSize,mainCanvasSize.y-touchGamepadSize),i=mainCanvasSize.subtract(vec2(touchGamepadSize,touchGamepadSize)),a=mainCanvasSize.scale(.5);for(const s of e.touches)(e=mouseToScreen(vec2(s.clientX,s.clientY))).distance(t)<touchGamepadSize?touchGamepadAnalog?touchGamepadStick=e.subtract(t).scale(2/touchGamepadSize).clampLength():(e=e.subtract(t).angle(),touchGamepadStick.setAngle((4*e/PI+8.5|0)*PI/4)):e.distance(i)<touchGamepadSize?(e=e.subtract(i).direction(),touchGamepadButtons[e]=1):e.distance(a)<touchGamepadSize&&(touchGamepadButtons[9]=1)}}))}function touchGamepadRender(){if(touchGamepadEnable&&touchGamepadTimer.isSet()){var e=percent(touchGamepadTimer.get(),4,3);if(e&&!paused){if(overlayContext.save(),overlayContext.globalAlpha=e*touchGamepadAlpha,overlayContext.strokeStyle="#fff",overlayContext.lineWidth=3,overlayContext.fillStyle=0<touchGamepadStick.lengthSquared()?"#fff":"#000",overlayContext.beginPath(),e=vec2(touchGamepadSize,mainCanvasSize.y-touchGamepadSize),touchGamepadAnalog)overlayContext.arc(e.x,e.y,touchGamepadSize/2,0,9),overlayContext.fill();else for(var t=10;t--;){var i=t*PI/4;overlayContext.arc(e.x,e.y,.6*touchGamepadSize,i+PI/8,i+PI/8),t%2&&overlayContext.arc(e.x,e.y,.33*touchGamepadSize,i,i),1==t&&overlayContext.fill()}for(overlayContext.stroke(),e=vec2(mainCanvasSize.x-touchGamepadSize,mainCanvasSize.y-touchGamepadSize),t=4;t--;)i=e.add((new Vector2).setAngle(t*PI/2,touchGamepadSize/2)),overlayContext.fillStyle=touchGamepadButtons[t]?"#fff":"#000",overlayContext.beginPath(),overlayContext.arc(i.x,i.y,touchGamepadSize/4,0,9),overlayContext.fill(),overlayContext.stroke();overlayContext.restore()}}}class Sound{constructor(e,t=soundDefaultRange,i=soundDefaultTaper){soundEnable&&(this.range=t,this.taper=i,this.randomness=e[1]||0,e[1]=0,this.cachedSamples=zzfxG(...e))}play(e,t=1,i=1,a=1){if(soundEnable){var s=0;if(e){if(s=this.range){const i=cameraPos.distanceSquared(e);if(i>s*s)return;t*=percent(i**.5,s,s*this.taper)}s=2*worldToScreen(e).x/mainCanvas.width-1}return e=i+i*this.randomness*a*rand(-1,1),playSamples([this.cachedSamples],t,e,s)}}playNote(e,t,i=1){if(soundEnable)return this.play(t,i,2**(e/12),0)}}class Music{constructor(e){soundEnable&&(this.cachedSamples=zzfxM(...e))}play(e=1,t=1){if(soundEnable)return playSamples(this.cachedSamples,e,1,0,t)}}function playAudioFile(e,t=1,i=1){if(soundEnable)return(e=new Audio(e)).volume=soundVolume*t,e.loop=i,e.play(),e}function speak(e,t="",i=1,a=1,s=1){if(soundEnable&&speechSynthesis)return(e=new SpeechSynthesisUtterance(e)).lang=t,e.volume=2*i*soundVolume,e.rate=a,e.pitch=s,speechSynthesis.speak(e),e}const speakStop=()=>speechSynthesis&&speechSynthesis.cancel(),getNoteFrequency=(e,t=220)=>t*2**(e/12);let audioContext;function playSamples(e,t=1,i=1,a=0,s=0){if(soundEnable&&(audioContext||(audioContext=new(window.AudioContext||webkitAudioContext)),audioContext.resume(),"running"==audioContext.state)){var n=audioContext.createBuffer(e.length,e[0].length,zzfxR),l=audioContext.createBufferSource();return e.forEach((e,t)=>n.getChannelData(t).set(e)),l.buffer=n,l.playbackRate.value=i,l.loop=s,(e=audioContext.createGain()).gain.value=soundVolume*t,e.connect(audioContext.destination),(window.StereoPannerNode?l.connect(new StereoPannerNode(audioContext,{pan:clamp(a,-1,1)})):l).connect(e),l.start(),l}}const zzfx=(...e)=>playSamples([zzfxG(...e)]),zzfxR=44100;function zzfxG(e=1,t=.05,i=220,a=0,s=0,n=.1,l=0,o=1,r=0,c=0,h=0,d=0,g=0,m=0,u=0,p=0,y=0,S=1,x=0,v=0){let C=2*PI,f=r*=500*C/zzfxR/zzfxR,T=[];t=i*=(1+t*rand(-1,1))*C/zzfxR;let b,D,E=0,A=0,z=0,w=1,R=0,_=0,I=0;for(c*=500*C/zzfxR**3,u*=C/zzfxR,h*=C/zzfxR,d*=zzfxR,g=g*zzfxR|0,D=(a=a*zzfxR+9)+(x*=zzfxR)+(s*=zzfxR)+(n*=zzfxR)+(y*=zzfxR)|0;z<D;T[z++]=I)++_%(100*p|0)||(I=l?1<l?2<l?3<l?Math.sin((E%C)**3):max(min(Math.tan(E),1),-1):1-(2*E/C%2+2)%2:1-4*abs(Math.round(E/C)-E/C):Math.sin(E),I=(g?1-v+v*Math.sin(C*z/g):1)*sign(I)*abs(I)**o*e*soundVolume*(z<a?z/a:z<a+x?1-(z-a)/x*(1-S):z<a+x+s?S:z<D-y?(D-z-y)/n*S:0),I=y?I/2+(y>z?0:(z<D-y?1:(D-z)/y)*T[z-y|0]/2):I),E+=(b=(i+=r+=c)*Math.cos(u*A++))-b*m*(1-1e9*(Math.sin(z)+1)%2),w&&++w>d&&(i+=h,t+=h,w=0),!g||++R%g||(i=t,r=f,w=w||1);return T}function zzfxM(e,t,i,a=125){let s,n,l,o,r,c,h,d,g,m,u,p,y,S,x=0,v=[],C=[],f=[],T=0,b=0,D=1,E={},A=zzfxR/a*60>>2;for(;D;T++)v=[D=d=p=0],i.forEach((a,z)=>{for(h=t[a][T]||[0,0,0],D|=!!t[a][T],S=p+(t[a][0].length-2-!d)*A,y=z==i.length-1,n=2,o=p;n<h.length+y;d=++n){for(r=h[n],g=n==h.length+y-1&&y||m!=(h[0]||0)|r|0,l=0;l<A&&d;l++>A-99&&g?u+=(1>u)/99:0)c=(1-u)*v[x++]/2||0,C[o]=(C[o]||0)-c*b+c,f[o]=(f[o++]||0)+c*b+c;r&&(u=r%1,b=h[1]||0,r|=0)&&(v=E[[m=h[x=0]||0,r]]=E[[m,r]]||((s=[...e[m]])[2]*=2**((r-12)/12),0<r?zzfxG(...s):[]))}p=S});return[C,f]}let tileCollision=[],tileCollisionSize=vec2();function initTileCollision(e){for(e=(tileCollision=[]).length=(tileCollisionSize=e).area();e--;)tileCollision[e]=0}const setTileCollisionData=(e,t=0)=>e.arrayCheck(tileCollisionSize)&&(tileCollision[(0|e.y)*tileCollisionSize.x+e.x|0]=t),getTileCollisionData=e=>e.arrayCheck(tileCollisionSize)?tileCollision[(0|e.y)*tileCollisionSize.x+e.x|0]:0;function tileCollisionTest(e,t=vec2(),i){const a=max(e.x-t.x/2|0,0);var s=max(e.y-t.y/2|0,0);const n=min(e.x+t.x/2,tileCollisionSize.x);for(e=min(e.y+t.y/2,tileCollisionSize.y);s<e;++s)for(t=a;t<n;++t){const e=tileCollision[s*tileCollisionSize.x+t];if(e&&(!i||i.collideWithTile(e,new Vector2(t,s))))return 1}}function tileCollisionRaycast(e,t,i){e=e.floor();var a=(t=t.floor()).subtract(e);const s=abs(a.x),n=-abs(a.y),l=sign(a.x);a=sign(a.y);let o=s+n;for(let c=e.x,h=e.y;;){var r=getTileCollisionData(vec2(c,h));if(r&&(i?i.collideWithTileRaycast(r,new Vector2(c,h)):0<r))return debugRaycast&&debugLine(e,t,"#f00",.02,1),debugRaycast&&debugPoint(new Vector2(c+.5,h+.5),"#ff0",1),new Vector2(c+.5,h+.5);if(c==t.x&h==t.y)break;(r=2*o)>=n&&(o+=n,c+=l),r<=s&&(o+=s,h+=a)}debugRaycast&&debugLine(e,t,"#00f",.02,1)}class TileLayerData{constructor(e,t=0,i=0,a=new Color){this.tile=e,this.direction=t,this.mirror=i,this.color=a}clear(){this.tile=this.direction=this.mirror=0,color=new Color}}class TileLayer extends EngineObject{constructor(e,t=tileCollisionSize,i=tileSizeDefault,a=vec2(1),s=0){for(super(e,t,-1,i,0,void 0,s),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.scale=a,this.isOverlay,this.data=[],e=this.size.area();e--;)this.data.push(new TileLayerData)}setData(e,t,i){e.arrayCheck(this.size)&&(this.data[(0|e.y)*this.size.x+e.x|0]=t,i&&this.drawTileData(e))}getData(e){return e.arrayCheck(this.size)&&this.data[(0|e.y)*this.size.x+e.x|0]}update(){}render(){ASSERT(mainContext!=this.context),glEnable&&!glOverlay&&!this.isOverlay&&glCopyToContext(mainContext);const e=worldToScreen(this.pos.add(vec2(0,this.size.y*this.scale.y)));(this.isOverlay?overlayContext:mainContext).drawImage(this.canvas,e.x,e.y,cameraScale*this.size.x*this.scale.x,cameraScale*this.size.y*this.scale.y)}redraw(){this.redrawStart(1),this.drawAllTileData(),this.redrawEnd()}redrawStart(e=0){e&&(this.canvas.width=this.size.x*this.tileSize.x,this.canvas.height=this.size.y*this.tileSize.y),this.savedRenderSettings=[mainCanvas,mainContext,cameraPos,cameraScale],mainCanvas=this.canvas,mainContext=this.context,cameraPos=this.size.scale(.5),cameraScale=this.tileSize.x,enginePreRender()}redrawEnd(){ASSERT(mainContext==this.context),glCopyToContext(mainContext,1),[mainCanvas,mainContext,cameraPos,cameraScale]=this.savedRenderSettings}drawTileData(e){const t=e.floor().add(this.pos).add(vec2(.5));this.drawCanvas2D(t,vec2(1),0,0,e=>e.clearRect(-.5,-.5,1,1)),null!=(e=this.getData(e)).tile&&(ASSERT(mainContext==this.context),drawTile(t,vec2(1),e.tile,this.tileSize,e.color,e.direction*PI/2,e.mirror))}drawAllTileData(){for(let e=this.size.x;e--;)for(let t=this.size.y;t--;)this.drawTileData(vec2(e,t))}drawCanvas2D(e,t,i=0,a,s){const n=this.context;n.save(),e=e.subtract(this.pos).multiply(this.tileSize),t=t.multiply(this.tileSize),n.translate(e.x,this.canvas.height-e.y),n.rotate(i),n.scale(a?-t.x:t.x,t.y),s(n),n.restore()}drawTile(e,t=vec2(1),i=-1,a=tileSizeDefault,s=new Color,n,l){this.drawCanvas2D(e,t,n,l,e=>{if(0>i)e.fillStyle=s,e.fillRect(-.5,-.5,1,1);else{const t=tileImage.width/a.x;e.globalAlpha=s.a,e.drawImage(tileImage,i%t*a.x,(i/t|0)*a.x,a.x,a.y,-.5,-.5,1,1)}})}drawRect(e,t,i,a){this.drawTile(e,t,-1,0,i,a)}}class ParticleEmitter extends EngineObject{constructor(e,t,i=0,a=0,s=100,n=PI,l=-1,o=tileSizeDefault,r=new Color,c=new Color,h=new Color(1,1,1,0),d=new Color(1,1,1,0),g=.5,m=.1,u=1,p=.1,y=.05,S=1,x=1,v=0,C=PI,f=.1,T=.2,b,D,E=1,A=(D?1e9:0)){super(e,new Vector2,l,o,t,void 0,A),this.emitSize=i,this.emitTime=a,this.emitRate=s,this.emitConeAngle=n,this.colorStartA=r,this.colorStartB=c,this.colorEndA=h,this.colorEndB=d,this.randomColorLinear=E,this.particleTime=g,this.sizeStart=m,this.sizeEnd=u,this.speed=p,this.angleSpeed=y,this.damping=S,this.angleDamping=x,this.gravityScale=v,this.particleConeAngle=C,this.fadeRate=f,this.randomness=T,this.collideTiles=b,this.additive=D,this.emitTimeBuffer=this.trailScale=0}update(){if(this.parent&&super.update(),!this.emitTime||this.getAliveTime()<=this.emitTime){if(this.emitRate*particleEmitRateScale){const e=1/this.emitRate/particleEmitRateScale;for(this.emitTimeBuffer+=timeDelta;0<this.emitTimeBuffer;this.emitTimeBuffer-=e)this.emitParticle()}}else this.destroy();debugParticles&&debugRect(this.pos,vec2(this.emitSize),"#0f0",0,this.angle)}emitParticle(){var e=null!=this.emitSize.x?new Vector2(rand(-.5,.5),rand(-.5,.5)).multiply(this.emitSize).rotate(this.angle):randInCircle(.5*this.emitSize);e=new Particle(this.pos.add(e),this.tileIndex,this.tileSize,this.angle+rand(this.particleConeAngle,-this.particleConeAngle));const t=this.randomness;var i=e=>e+e*rand(t,-t);const a=i(this.particleTime),s=i(this.sizeStart),n=i(this.sizeEnd),l=i(this.speed);i=i(this.angleSpeed)*randSign();const o=rand(this.emitConeAngle,-this.emitConeAngle),r=randColor(this.colorStartA,this.colorStartB,this.randomColorLinear),c=randColor(this.colorEndA,this.colorEndB,this.randomColorLinear);return e.colorStart=r,e.colorEndDelta=c.subtract(r),e.velocity=(new Vector2).setAngle(this.angle+o,l),e.angleVelocity=i,e.lifeTime=a,e.sizeStart=s,e.sizeEndDelta=n-s,e.fadeRate=this.fadeRate,e.damping=this.damping,e.angleDamping=this.angleDamping,e.elasticity=this.elasticity,e.friction=this.friction,e.gravityScale=this.gravityScale,e.collideTiles=this.collideTiles,e.additive=this.additive,e.renderOrder=this.renderOrder,e.trailScale=this.trailScale,e.mirror=.5>rand(),e.destroyCallback=this.particleDestroyCallback,this.particleCreateCallback&&this.particleCreateCallback(e),e}render(){}}class Particle extends EngineObject{constructor(e,t,i,a){super(e,new Vector2,t,i,a)}render(){const e=min((time-this.spawnTime)/this.lifeTime,1);var t=this.sizeStart+e*this.sizeEndDelta;t=new Vector2(t,t);var i=this.fadeRate/2;if(i=new Color(this.colorStart.r+e*this.colorEndDelta.r,this.colorStart.g+e*this.colorEndDelta.g,this.colorStart.b+e*this.colorEndDelta.b,(this.colorStart.a+e*this.colorEndDelta.a)*(e<i?e/i:e>1-i?(1-e)/i:1)),this.additive&&setBlendMode(1),this.trailScale){var a=this.velocity.length();const e=this.velocity.scale(1/a);a*=this.trailScale,t.y=max(t.x,a),this.angle=e.angle(),drawTile(this.pos.add(e.multiply(vec2(0,-a/2))),t,this.tileIndex,this.tileSize,i,this.angle,this.mirror)}else drawTile(this.pos,t,this.tileIndex,this.tileSize,i,this.angle,this.mirror);this.additive&&setBlendMode(),debugParticles&&debugRect(this.pos,t,"#f005",0,this.angle),1==e&&(this.color=i,this.size=t,this.destroyCallback&&this.destroyCallback(this),this.destroyed=1)}}const medals=[];let medalsPreventUnlock,newgrounds,medalsDisplayQueue=[],medalsSaveName,medalsDisplayTimeLast;function medalsInit(e){medalsSaveName=e,debugMedals||medals.forEach(e=>localStorage[e.storageKey()])}class Medal{constructor(e,t,i="",a="🏆",s){ASSERT(0<=e&&!medals[e]),medals[this.id=e]=this,this.name=t,this.description=i,this.icon=a,this.image=new Image,s&&(this.image.src=s)}unlock(){medalsPreventUnlock||this.unlocked||(ASSERT(medalsSaveName),localStorage[this.storageKey()]=this.unlocked=1,medalsDisplayQueue.push(this),newgrounds&&newgrounds.unlockMedal(this.id),localStorage["OS13kTrophy,"+this.icon+","+medalsSaveName+","+this.name]=this.description)}render(e=0){const t=overlayContext,i=min(medalDisplayWidth,mainCanvas.width),a=overlayCanvas.width-i;e*=-medalDisplayHeight,t.save(),t.beginPath(),t.fillStyle="#ddd",t.fill(t.rect(a,e,i,medalDisplayHeight)),t.strokeStyle="#000",t.lineWidth=3,t.stroke(),t.clip(),this.renderIcon(a+15+medalDisplayIconSize/2,e+medalDisplayHeight/2),t.textAlign="left",t.font="38px "+fontDefault,t.fillText(this.name,a+medalDisplayIconSize+30,e+28),t.font="24px "+fontDefault,t.fillText(this.description,a+medalDisplayIconSize+30,e+60),t.restore()}renderIcon(e,t,i=medalDisplayIconSize){const a=overlayContext;a.fillStyle="#000",a.textAlign="center",a.textBaseline="middle",a.font=.7*i+"px "+fontDefault,this.image.src?a.drawImage(this.image,e-i/2,t-i/2,i,i):a.fillText(this.icon,e,t)}storageKey(){return medalsSaveName+"_"+this.id}}function medalsRender(){if(medalsDisplayQueue.length){var e=medalsDisplayQueue[0],t=timeReal-medalsDisplayTimeLast;if(medalsDisplayTimeLast)if(t>medalDisplayTime)medalsDisplayQueue.shift(medalsDisplayTimeLast=0);else{const i=medalDisplayTime-medalDisplaySlideTime;e.render(t<medalDisplaySlideTime?1-t/medalDisplaySlideTime:t>i?(t-i)/medalDisplaySlideTime:0)}else medalsDisplayTimeLast=timeReal}}class Newgrounds{constructor(e,t){if(ASSERT(!newgrounds&&e),this.app_id=e,this.cipher=t,this.host=location?location.hostname:"",t&&(this.cryptoJS=CryptoJS()),this.session_id=new URL(location.href).searchParams.get("ngio_session_id")||0,0!=this.session_id){for(var i of(this.medals=(e=this.call("Medal.getList"))?e.result.data.medals:[],debugMedals&&console.log(this.medals),this.medals))(e=medals[i.id])&&(e.image.src=i.icon,e.name=i.name,e.description=i.description,e.unlocked=i.unlocked,e.difficulty=i.difficulty,e.value=i.value,e.value&&(e.description=e.description+" ("+e.value+")"));this.scoreboards=(i=this.call("ScoreBoard.getBoards"))?i.result.data.scoreboards:[],debugMedals&&console.log(this.scoreboards),setInterval(()=>this.call("Gateway.ping",0,1),3e5)}}unlockMedal(e){return this.call("Medal.unlock",{id:e},1)}postScore(e,t){return this.call("ScoreBoard.postScore",{id:e,value:t},1)}getScores(e,t=0,i=0,a=0,s=10){return this.call("ScoreBoard.getScores",{id:e,user:t,social:i,skip:a,limit:s})}logView(){return this.call("App.logView",{host:this.host},1)}call(e,t=0,i=0){if(e={component:e,parameters:t},this.cipher){var a=(t=this.cryptoJS).enc.Base64.parse(this.cipher);const i=t.lib.WordArray.random(16);a=t.AES.encrypt(JSON.stringify(e),a,{iv:i}),e.secure=t.enc.Base64.stringify(i.concat(a.ciphertext)),e.parameters=0}return t={app_id:this.app_id,session_id:this.session_id,call:e},(e=new FormData).append("input",JSON.stringify(t)),(t=new XMLHttpRequest).open("POST","https://newgrounds.io/gateway_v3.php",!debugMedals&&i),t.send(e),debugMedals&&console.log(t.responseText),t.responseText&&JSON.parse(t.responseText)}}const CryptoJS=()=>eval(Function("[M='GBMGXz^oVYPPKKbB`agTXU|LxPc_ZBcMrZvCr~wyGfWrwk@ATqlqeTp^N?p{we}jIpEnB_sEr`l?YDkDhWhprc|Er|XETG?pTl`e}dIc[_N~}fzRycIfpW{HTolvoPB_FMe_eH~BTMx]yyOhv?biWPCGc]kABencBhgERHGf{OL`Dj`c^sh@canhy[secghiyotcdOWgO{tJIE^JtdGQRNSCrwKYciZOa]Y@tcRATYKzv|sXpboHcbCBf`}SKeXPFM|RiJsSNaIb]QPc[D]Jy_O^XkOVTZep`ONmntLL`Qz~UupHBX_Ia~WX]yTRJIxG`ioZ{fefLJFhdyYoyLPvqgH?b`[TMnTwwfzDXhfM?rKs^aFr|nyBdPmVHTtAjXoYUloEziWDCw_suyYT~lSMksI~ZNCS[Bex~j]Vz?kx`gdYSEMCsHpjbyxQvw|XxX_^nQYue{sBzVWQKYndtYQMWRef{bOHSfQhiNdtR{o?cUAHQAABThwHPT}F{VvFmgN`E@FiFYS`UJmpQNM`X|tPKHlccT}z}k{sACHL?Rt@MkWplxO`ASgh?hBsuuP|xD~LSH~KBlRs]t|l|_tQAroDRqWS^SEr[sYdPB}TAROtW{mIkE|dWOuLgLmJrucGLpebrAFKWjikTUzS|j}M}szasKOmrjy[?hpwnEfX[jGpLt@^v_eNwSQHNwtOtDgWD{rk|UgASs@mziIXrsHN_|hZuxXlPJOsA^^?QY^yGoCBx{ekLuZzRqQZdsNSx@ezDAn{XNj@fRXIwrDX?{ZQHwTEfu@GhxDOykqts|n{jOeZ@c`dvTY?e^]ATvWpb?SVyg]GC?SlzteilZJAL]mlhLjYZazY__qcVFYvt@|bIQnSno@OXyt]OulzkWqH`rYFWrwGs`v|~XeTsIssLrbmHZCYHiJrX}eEzSssH}]l]IhPQhPoQ}rCXLyhFIT[clhzYOvyHqigxmjz`phKUU^TPf[GRAIhNqSOdayFP@FmKmuIzMOeoqdpxyCOwCthcLq?n`L`tLIBboNn~uXeFcPE{C~mC`h]jUUUQe^`UqvzCutYCgct|SBrAeiYQW?X~KzCz}guXbsUw?pLsg@hDArw?KeJD[BN?GD@wgFWCiHq@Ypp_QKFixEKWqRp]oJFuVIEvjDcTFu~Zz]a{IcXhWuIdMQjJ]lwmGQ|]g~c]Hl]pl`Pd^?loIcsoNir_kikBYyg?NarXZEGYspt_vLBIoj}LI[uBFvm}tbqvC|xyR~a{kob|HlctZslTGtPDhBKsNsoZPuH`U`Fqg{gKnGSHVLJ^O`zmNgMn~{rsQuoymw^JY?iUBvw_~mMr|GrPHTERS[MiNpY[Mm{ggHpzRaJaoFomtdaQ_?xuTRm}@KjU~RtPsAdxa|uHmy}n^i||FVL[eQAPrWfLm^ndczgF~Nk~aplQvTUpHvnTya]kOenZlLAQIm{lPl@CCTchvCF[fI{^zPkeYZTiamoEcKmBMfZhk_j_~Fjp|wPVZlkh_nHu]@tP|hS@^G^PdsQ~f[RqgTDqezxNFcaO}HZhb|MMiNSYSAnQWCDJukT~e|OTgc}sf[cnr?fyzTa|EwEtRG|I~|IO}O]S|rp]CQ}}DWhSjC_|z|oY|FYl@WkCOoPuWuqr{fJu?Brs^_EBI[@_OCKs}?]O`jnDiXBvaIWhhMAQDNb{U`bqVR}oqVAvR@AZHEBY@depD]OLh`kf^UsHhzKT}CS}HQKy}Q~AeMydXPQztWSSzDnghULQgMAmbWIZ|lWWeEXrE^EeNoZApooEmrXe{NAnoDf`m}UNlRdqQ@jOc~HLOMWs]IDqJHYoMziEedGBPOxOb?[X`KxkFRg@`mgFYnP{hSaxwZfBQqTm}_?RSEaQga]w[vxc]hMne}VfSlqUeMo_iqmd`ilnJXnhdj^EEFifvZyxYFRf^VaqBhLyrGlk~qowqzHOBlOwtx?i{m~`n^G?Yxzxux}b{LSlx]dS~thO^lYE}bzKmUEzwW^{rPGhbEov[Plv??xtyKJshbG`KuO?hjBdS@Ru}iGpvFXJRrvOlrKN?`I_n_tplk}kgwSXuKylXbRQ]]?a|{xiT[li?k]CJpwy^o@ebyGQrPfF`aszGKp]baIx~H?ElETtFh]dz[OjGl@C?]VDhr}OE@V]wLTc[WErXacM{We`F|utKKjgllAxvsVYBZ@HcuMgLboFHVZmi}eIXAIFhS@A@FGRbjeoJWZ_NKd^oEH`qgy`q[Tq{x?LRP|GfBFFJV|fgZs`MLbpPYUdIV^]mD@FG]pYAT^A^RNCcXVrPsgk{jTrAIQPs_`mD}rOqAZA[}RETFz]WkXFTz_m{N@{W@_fPKZLT`@aIqf|L^Mb|crNqZ{BVsijzpGPEKQQZGlApDn`ruH}cvF|iXcNqK}cxe_U~HRnKV}sCYb`D~oGvwG[Ca|UaybXea~DdD~LiIbGRxJ_VGheI{ika}KC[OZJLn^IBkPrQj_EuoFwZ}DpoBRcK]Q}?EmTv~i_Tul{bky?Iit~tgS|o}JL_VYcCQdjeJ_MfaA`FgCgc[Ii|CBHwq~nbJeYTK{e`CNstKfTKPzw{jdhp|qsZyP_FcugxCFNpKitlR~vUrx^NrSVsSTaEgnxZTmKc`R|lGJeX}ccKLsQZQhsFkeFd|ckHIVTlGMg`~uPwuHRJS_CPuN_ogXe{Ba}dO_UBhuNXby|h?JlgBIqMKx^_u{molgL[W_iavNQuOq?ap]PGB`clAicnl@k~pA?MWHEZ{HuTLsCpOxxrKlBh]FyMjLdFl|nMIvTHyGAlPogqfZ?PlvlFJvYnDQd}R@uAhtJmDfe|iJqdkYr}r@mEjjIetDl_I`TELfoR|qTBu@Tic[BaXjP?dCS~MUK[HPRI}OUOwAaf|_}HZzrwXvbnNgltjTwkBE~MztTQhtRSWoQHajMoVyBBA`kdgK~h`o[J`dm~pm]tk@i`[F~F]DBlJKklrkR]SNw@{aG~Vhl`KINsQkOy?WhcqUMTGDOM_]bUjVd|Yh_KUCCgIJ|LDIGZCPls{RzbVWVLEhHvWBzKq|^N?DyJB|__aCUjoEgsARki}j@DQXS`RNU|DJ^a~d{sh_Iu{ONcUtSrGWW@cvUjefHHi}eSSGrNtO?cTPBShLqzwMVjWQQCCFB^culBjZHEK_{dO~Q`YhJYFn]jq~XSnG@[lQr]eKrjXpG~L^h~tDgEma^AUFThlaR{xyuP@[^VFwXSeUbVetufa@dX]CLyAnDV@Bs[DnpeghJw^?UIana}r_CKGDySoRudklbgio}kIDpA@McDoPK?iYcG?_zOmnWfJp}a[JLR[stXMo?_^Ng[whQlrDbrawZeSZ~SJstIObdDSfAA{MV}?gNunLOnbMv_~KFQUAjIMj^GkoGxuYtYbGDImEYiwEMyTpMxN_LSnSMdl{bg@dtAnAMvhDTBR_FxoQgANniRqxd`pWv@rFJ|mWNWmh[GMJz_Nq`BIN@KsjMPASXORcdHjf~rJfgZYe_uulzqM_KdPlMsuvU^YJuLtofPhGonVOQxCMuXliNvJIaoC?hSxcxKVVxWlNs^ENDvCtSmO~WxI[itnjs^RDvI@KqG}YekaSbTaB]ki]XM@[ZnDAP~@|BzLRgOzmjmPkRE@_sobkT|SszXK[rZN?F]Z_u}Yue^[BZgLtR}FHzWyxWEX^wXC]MJmiVbQuBzkgRcKGUhOvUc_bga|Tx`KEM`JWEgTpFYVeXLCm|mctZR@uKTDeUONPozBeIkrY`cz]]~WPGMUf`MNUGHDbxZuO{gmsKYkAGRPqjc|_FtblEOwy}dnwCHo]PJhN~JoteaJ?dmYZeB^Xd?X^pOKDbOMF@Ugg^hETLdhwlA}PL@_ur|o{VZosP?ntJ_kG][g{Zq`Tu]dzQlSWiKfnxDnk}KOzp~tdFstMobmy[oPYjyOtUzMWdjcNSUAjRuqhLS@AwB^{BFnqjCmmlk?jpn}TksS{KcKkDboXiwK]qMVjm~V`LgWhjS^nLGwfhAYrjDSBL_{cRus~{?xar_xqPlArrYFd?pHKdMEZzzjJpfC?Hv}mAuIDkyBxFpxhstTx`IO{rp}XGuQ]VtbHerlRc_LFGWK[XluFcNGUtDYMZny[M^nVKVeMllQI[xtvwQnXFlWYqxZZFp_|]^oWX[{pOMpxXxvkbyJA[DrPzwD|LW|QcV{Nw~U^dgguSpG]ClmO@j_TENIGjPWwgdVbHganhM?ema|dBaqla|WBd`poj~klxaasKxGG^xbWquAl~_lKWxUkDFagMnE{zHug{b`A~IYcQYBF_E}wiA}K@yxWHrZ{[d~|ARsYsjeNWzkMs~IOqqp[yzDE|WFrivsidTcnbHFRoW@XpAV`lv_zj?B~tPCppRjgbbDTALeFaOf?VcjnKTQMLyp{NwdylHCqmo?oelhjWuXj~}{fpuX`fra?GNkDiChYgVSh{R[BgF~eQa^WVz}ATI_CpY?g_diae]|ijH`TyNIF}|D_xpmBq_JpKih{Ba|sWzhnAoyraiDvk`h{qbBfsylBGmRH}DRPdryEsSaKS~tIaeF[s]I~xxHVrcNe@Jjxa@jlhZueLQqHh_]twVMqG_EGuwyab{nxOF?`HCle}nBZzlTQjkLmoXbXhOtBglFoMz?eqre`HiE@vNwBulglmQjj]DB@pPkPUgA^sjOAUNdSu_`oAzar?n?eMnw{{hYmslYi[TnlJD'",..."]charCodeAtUinyxpf","for(;e<10359;c[e++]=p-=128,A=A?p-A&&A:p==34&&p)for(p=1;p<128;y=f.map((n,x)=>(U=r[n]*2+1,U=Math.log(U/(h-U)),t-=a[x]*U,U/500)),t=~-h/(1+Math.exp(t))|1,i=o%h<t,o=o%h+(i?t:h-t)*(o>>17)-!i*t,f.map((n,x)=>(U=r[n]+=(i*h/2-r[n]<<13)/((C[n]+=C[n]<5)+1/20)>>13,a[x]+=y[x]*(i-t/h))),p=p*2+i)for(f='010202103203210431053105410642065206541'.split(t=0).map((n,x)=>(U=0,[...n].map((n,x)=>(U=U*997+(c[e-n]|0)|0)),h*32-1&U*997+p+!!A*129)*12+x);o<h*32;o=o*64|M.charCodeAt(d++)&63);for(C=String.fromCharCode(...c);r=/[\0-#?@\\\\~]/.exec(C);)with(C.split(r))C=join(shift());return C")([],[],131072,[0,0,0,0,0,0,0,0,0,0,0,0],new Uint16Array(51e6).fill(32768),new Uint8Array(51e6),0,0,0,0));let glCanvas,glContext,glTileTexture,glActiveTexture,glShader,glPositionData,glColorData,glBatchCount,glBatchAdditive,glAdditive;function glInit(){if(glEnable){glCanvas=document.createElement("canvas"),glContext=glCanvas.getContext("webgl",{antialias:!1}),glCanvas.style=styleCanvas,glTileTexture=glCreateTexture(tileImage),glOverlay&&document.body.appendChild(glCanvas),glShader=glCreateProgram("precision highp float;uniform mat4 m;attribute vec2 p,t;attribute vec4 c,a;varying vec2 v;varying vec4 d,e;void main(){gl_Position=m*vec4(p,1,1);v=t;d=c;e=a;}","precision highp float;varying vec2 v;varying vec4 d,e;uniform sampler2D s;void main(){gl_FragColor=texture2D(s,v)*d+e;}");var e=new ArrayBuffer(gl_MAX_BATCH*gl_VERTICES_PER_QUAD*gl_VERTEX_BYTE_STRIDE);glCreateBuffer(gl_ARRAY_BUFFER,e.byteLength,gl_DYNAMIC_DRAW),glPositionData=new Float32Array(e),glColorData=new Uint32Array(e);var t=glBatchCount=0;(e=((e,i,a,s,n=0)=>{e=glContext.getAttribLocation(glShader,e),glContext.enableVertexAttribArray(e),glContext.vertexAttribPointer(e,s,i,n,gl_VERTEX_BYTE_STRIDE,t),t+=s*a}))("p",gl_FLOAT,4,2),e("t",gl_FLOAT,4,2),e("c",gl_UNSIGNED_BYTE,1,4,1),e("a",gl_UNSIGNED_BYTE,1,4,1)}}function glSetBlendMode(e){glEnable&&(glAdditive=e)}function glSetTexture(e=glTileTexture){glEnable&&(e!=glActiveTexture&&glFlush(),glContext.bindTexture(gl_TEXTURE_2D,glActiveTexture=e))}function glCompileShader(e,t){if(glEnable){if(t=glContext.createShader(t),glContext.shaderSource(t,e),glContext.compileShader(t),debug&&!glContext.getShaderParameter(t,gl_COMPILE_STATUS))throw glContext.getShaderInfoLog(t);return t}}function glCreateProgram(e,t){if(glEnable){var i=glContext.createProgram();if(glContext.attachShader(i,glCompileShader(e,gl_VERTEX_SHADER)),glContext.attachShader(i,glCompileShader(t,gl_FRAGMENT_SHADER)),glContext.linkProgram(i),debug&&!glContext.getProgramParameter(i,gl_LINK_STATUS))throw glContext.getProgramInfoLog(i);return i}}function glCreateBuffer(e,t,i){if(glEnable){var a=glContext.createBuffer();return glContext.bindBuffer(e,a),glContext.bufferData(e,t,i),a}}function glCreateTexture(e){if(glEnable&&e&&e.width){var t=glContext.createTexture();return glContext.bindTexture(gl_TEXTURE_2D,t),glContext.texImage2D(gl_TEXTURE_2D,0,gl_RGBA,gl_RGBA,gl_UNSIGNED_BYTE,e),glContext.texParameteri(gl_TEXTURE_2D,gl_TEXTURE_MIN_FILTER,cavasPixelated?gl_NEAREST:gl_LINEAR),glContext.texParameteri(gl_TEXTURE_2D,gl_TEXTURE_MAG_FILTER,cavasPixelated?gl_NEAREST:gl_LINEAR),glContext.texParameteri(gl_TEXTURE_2D,gl_TEXTURE_WRAP_S,gl_CLAMP_TO_EDGE),glContext.texParameteri(gl_TEXTURE_2D,gl_TEXTURE_WRAP_T,gl_CLAMP_TO_EDGE),t}}function glPreRender(e,t,i,a,s){glEnable&&(glContext.viewport(0,0,glCanvas.width=e,glCanvas.height=t),glContext.clear(gl_COLOR_BUFFER_BIT),glContext.bindTexture(gl_TEXTURE_2D,glActiveTexture=glTileTexture),glContext.useProgram(glShader),glSetBlendMode(),e=2*s/e,t=2*s/t,glContext.uniformMatrix4fv(glContext.getUniformLocation(glShader,"m"),0,new Float32Array([e,0,0,0,0,t,0,0,1,1,-1,1,-1-e*i,-1-t*a,0,0])))}function glFlush(){if(glEnable&&glBatchCount){var e=glBatchAdditive?gl_ONE:gl_ONE_MINUS_SRC_ALPHA;glContext.blendFuncSeparate(gl_SRC_ALPHA,e,gl_ONE,e),glContext.enable(gl_BLEND),glContext.bufferSubData(gl_ARRAY_BUFFER,0,glPositionData.subarray(0,glBatchCount*gl_VERTICES_PER_QUAD*gl_INDICIES_PER_VERT)),glContext.drawArrays(gl_TRIANGLES,0,glBatchCount*gl_VERTICES_PER_QUAD),glBatchCount=0,glBatchAdditive=glAdditive}}function glCopyToContext(e,t){(glEnable&&glBatchCount||t)&&(glFlush(),glOverlay&&!t||e.drawImage(glCanvas,0,0))}function glDraw(e,t,i,a,s,n,l,o,r,c=4294967295,h=0){if(glEnable){glBatchCount!=gl_MAX_BATCH&&glBatchAdditive==glAdditive||glFlush();var d=Math.cos(s)/2,g=Math.sin(s)/2;s=d*i,d*=a,i*=g,a*=g,g=glBatchCount++*gl_VERTICES_PER_QUAD*gl_INDICIES_PER_VERT,glPositionData[g++]=e-s-a,glPositionData[g++]=t-d+i,glPositionData[g++]=n,glPositionData[g++]=r,glColorData[g++]=c,glColorData[g++]=h,glPositionData[g++]=e+s+a,glPositionData[g++]=t+d-i,glPositionData[g++]=o,glPositionData[g++]=l,glColorData[g++]=c,glColorData[g++]=h,glPositionData[g++]=e-s+a,glPositionData[g++]=t+d+i,glPositionData[g++]=n,glPositionData[g++]=l,glColorData[g++]=c,glColorData[g++]=h,glPositionData[g++]=e-s-a,glPositionData[g++]=t-d+i,glPositionData[g++]=n,glPositionData[g++]=r,glColorData[g++]=c,glColorData[g++]=h,glPositionData[g++]=e+s-a,glPositionData[g++]=t-d-i,glPositionData[g++]=o,glPositionData[g++]=r,glColorData[g++]=c,glColorData[g++]=h,glPositionData[g++]=e+s+a,glPositionData[g++]=t+d-i,glPositionData[g++]=o,glPositionData[g++]=l,glColorData[g++]=c,glColorData[g++]=h}}const gl_ONE=1,gl_TRIANGLES=4,gl_SRC_ALPHA=770,gl_ONE_MINUS_SRC_ALPHA=771,gl_BLEND=3042,gl_TEXTURE_2D=3553,gl_UNSIGNED_BYTE=5121,gl_FLOAT=5126,gl_RGBA=6408,gl_NEAREST=9728,gl_LINEAR=9729,gl_TEXTURE_MAG_FILTER=10240,gl_TEXTURE_MIN_FILTER=10241,gl_TEXTURE_WRAP_S=10242,gl_TEXTURE_WRAP_T=10243,gl_COLOR_BUFFER_BIT=16384,gl_CLAMP_TO_EDGE=33071,gl_ARRAY_BUFFER=34962,gl_DYNAMIC_DRAW=35048,gl_FRAGMENT_SHADER=35632,gl_VERTEX_SHADER=35633,gl_COMPILE_STATUS=35713,gl_LINK_STATUS=35714,gl_VERTICES_PER_QUAD=6,gl_INDICIES_PER_VERT=6,gl_MAX_BATCH=65536,gl_VERTEX_BYTE_STRIDE=24;
"use strict";let sprites,timeMS,showFPS,statsDisplay,spriteColor,spriteAdditiveColor,musicSource;class TestObject extends EngineObject{constructor(e){super(e,vec2(1),0,vec2(16),0,spriteColor),this.additiveColor=spriteAdditiveColor,this.setCollision(1,1)}}function gameInit(){initTileCollision(vec2(80,50));for(let e=tileCollisionSize.x;e--;)setTileCollisionData(vec2(e,0),1),setTileCollisionData(vec2(e,tileCollisionSize.y-1),1);for(let e=tileCollisionSize.y;e--;)setTileCollisionData(vec2(0,e),1),setTileCollisionData(vec2(tileCollisionSize.x-1,e),1);cameraScale=16,cameraPos=tileCollisionSize.scale(.5),mainCanvas.style.background="#555",sprites=[],gravity=-.01,document.body.appendChild(statsDisplay=document.createElement("div")),statsDisplay.style="position:absolute;width:100%;top:50%;left:50%;transform:translate(-50%,-50%);font-size:6em;text-align:center;font-family:arial;user-select:none"}function gameUpdate(){if(!musicSource&&mouseWasPressed(0)&&(musicSource=music.play()),(mouseWasPressed(0)||mouseIsDown(2))&&(spriteColor=randColor(),spriteAdditiveColor=randColor(new Color(.5,.5,.5,0),new Color(0,0,0,0))),mouseIsDown(2)&&new TestObject(mousePos),mouseIsDown(0))for(let e=100;e--;)sprites.push({pos:mousePos.add(randInCircle(2)),angle:rand(),velocity:randInCircle(.2),color:spriteColor=spriteColor.mutate(),additiveColor:spriteAdditiveColor.mutate()});cameraScale=clamp(cameraScale*(1-mouseWheel/10),1,1e3)}function gameUpdatePost(){}function gameRender(){const e=Date.now();showFPS=lerp(.05,showFPS,1e3/(e-timeMS||1)),timeMS=e;const t=sprites.length,o=engineObjects.length;statsDisplay.innerText=t+o?t+" Sprites\n"+o+" Objects\n"+showFPS.toFixed(1)+" FPS":"LittleJS Stress Test\nLeft Click = Add Particles\nRight Click = Add Objects";vec2(.5);for(const e of sprites)e.pos.y=max(e.pos.y,0),e.velocity.y+=gravity,e.pos=e.pos.add(e.velocity),e.pos.y<0&&(e.velocity.y=rand(1,.5)),e.pos.x<0&&(e.pos.x=0,e.velocity.x*=-1),e.pos.x>tileCollisionSize.x&&(e.pos.x=tileCollisionSize.x,e.velocity.x*=-1),e.angle+=.01*sign(e.velocity.x),glDraw(e.pos.x,e.pos.y,1,1,e.angle,0,0,1,1,e.color.rgbaInt(),e.additiveColor.rgbaInt())}function gameRenderPost(){}const tilesImageData="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAYklEQVR42u2TQQqAQAwDPfg6P5SX+b7VgkpDhNH7DuTSNGFZ6LJv66OTUWoz9M28sCXyw2xLpjc/CiQNQpIVFGaKZa+I538JZ4EDYSgAsCB+Pma5OwtgGWd2ZUCE4xr/6M4d3aFsj7DwoPQAAAAASUVORK5CYII=";engineInit(gameInit,gameUpdate,gameUpdatePost,gameRender,gameRenderPost,tilesImageData);const music=new Music([[[,0,77,,,.7,2,.41,,,,,,,,.06],[,0,43,.01,,.3,2,,,,,,,,,.02,.01],[,0,170,.003,,.008,,.97,-35,53,,,,,,.1],[.8,0,270,,,.12,3,1.65,-2,,,,,4.5,,.02],[,0,86,,,.1,,.7,,,,.5,,6.7,1,.05],[,0,41,,.05,.4,2,0,,,9,.01,,,,.08,.02],[,0,2200,,,.04,3,2,,,800,.02,,4.8,,.01,.1],[.3,0,16,,,.3,3]],[[[1,-1,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33],[3,1,22,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,24,,,,,,,,,,,,,,,,,,,,,,,,22,,22,,22,,,,],[5,-1,21,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,23,,,,,,,,,,,,,,,,,,,,,,,,24,,23,,21,,,,],[,1,21,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,23,,,,,,,,,,,,,,,,,,,,,,,,24,,23,,21,,,,]],[[1,-1,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33],[3,1,24,,,,,,,,27,,,,,,,,,,,,,,,,27,,,,24,,,,24,,,,,,,,27,,,,,,,,,,,,,,,,24,,24,,24,,,,],[5,-1,21,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,23,,,,,,,,,,,,,,,,,,,,,,,,24,,23,,21,,,,],[,1,21,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,23,,,,,,,,,,,,,,,,,,,,,,,,24,,23,,21,,,,],[6,1,,,34,34,34,,,,,,34,34,,,,,34,,,,34,34,,,,,34,,,,34,,,,34,34,34,,,,,,34,,,,,,34,34,,,34,34,,,,,,,,,34,34],[4,1,,,,,,,24,,,,,,24,,24,,,,24,,,,24,,,,,,,,,,,,,,,,24,,,,,,24,,24,,,,24,,,,24,,,,,,,,,,]],[[1,-1,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,23,23,35,23,23,36,23,23,35,23,23,36,23,23,35,35,23,23,35,23,23,35,23,23,36,23,23,35,23,23,36,36],[5,-1,21,,,19,,,21,,,,,,,,,,21,,,19,,,17,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[3,1,24,,,24,,,24,,,,,,,,,,24,,,24,,,24,,,,24.75,24.5,24.26,24.01,24.01,24.01,,,,,25,,,,,,,,25,,,,,,,,25,,,,,,,,25,25,25,25],[4,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,24.75,24.5,24.26,24.01,24.01,24.01,24.01,24,,24,24,,24,24,24,24,,24,24,,24,,24,24,,24,24,,24,24,24,24,,24,24,,24,24],[7,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,23,,21,23,,35,,23,,21,23,,35,,35,,23,,21,23,,35,,21,23,,35,,21,23,,,],[6,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,34,36,34,,33,34,34,36,31,36,34,,31,34,32,,33,36,34,,31,34,34,36,33,36,33,,31,,,]],[[1,-1,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,17,17,29,17,17,29,17,17,29,17,17,29,17,17,29,29,17,17,29,17,17,29,17,17,29,17,17,29,17,17,29,29],[4,1,24,24,,24,24,,24,24,24,24,,24,24,,24,,24,24,,24,24,,24,24,24,24,,24,24,,24,24,24,24,,24,24,,24,24,24,,,24,24,,24,,24,24,,24,24,,24,24,24,24,,24,24,,24,24],[7,-1,21,,19,21,,33,,21,,19,21,,33,,33,,21,,19,21,,33,,21,,19,21,,33,,33,,17,,17,17,29,17,17,29,17,,17,17,29,17,17,29,17,,17,17,29,17,17,29,17,,17,17,29,17,17,29],[2,1,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,,,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,,,],[6,1,,,36,,,,,,36,,36,,,,,,,,36,,,,,,36,,36,,,,,,,,36,,,,,,,,,,,,,,,,36,,,,,,36,,36,,,,,,],[3,1,,,,,25,,,,,,,,25,,,,,,,,25,,,,,,,,25,25,25,25,,,,,25,,,,,25,,,25,,,,,,,,25,,,,,,,,25,25,25,25]],[[1,-1,14,14,26,14,14,26,14,14,26,14,14,26,14,14,26,26,14,14,26,14,14,26,14,14,26,14,14,26,14,14,26,26,17,17,29,17,17,29,17,17,29,17,17,29,17,17,29,29,19,19,31,19,19,31,19,19,31,19,19,31,19,19,31,31],[4,1,24,24,,24,24,,24,24,24,24,,24,24,,24,,24,24,,24,24,,24,24,24,24,,24,24,,24,24,24,24,,24,24,,24,24,24,24,,24,24,,36,,24,24,,24,24,,24,24,24,24,,24,24,,24,24],[7,-1,14,,14,14,26,14,14,26,14,,14,14,26,14,14,26,14,,14,14,26,14,14,26,14,,14,14,26,14,14,26,17,,17,17,29,17,17,29,17,,17,17,29,17,17,29,19,,19,19,31,19,19,31,19,,19,19,31,19,19,31],[2,1,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,,,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,,,],[3,1,,,,,25,,,,,,,,25,,,,,,,,25,,,,,,,,25,25,25,25,,,,,25,,,,,,,,25,,,,,,,,25,,,,,,,,25,25,25,25],[6,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,34,,,,,,34,,34,,,,,,,,34,,,,,,34,,34,,,,,,]]],[0,1,1,2,3,4,4]]);