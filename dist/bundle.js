(()=>{"use strict";let t=()=>{};let e,i,s={};function h(t,...e){(s[t]||[]).map((t=>t(...e)))}let n={get:(e,i)=>"_proxy"==i||t};function r(){return i}class a{constructor({spriteSheet:t,frames:e,frameRate:i,loop:s=!0}){this.spriteSheet=t,this.frames=e,this.frameRate=i,this.loop=s;let{width:h,height:n,margin:r=0}=t.frame;this.width=h,this.height=n,this.margin=r,this._f=0,this._a=0}clone(){return new a(this)}reset(){this._f=0,this._a=0}update(t=1/60){if(this.loop||this._f!=this.frames.length-1)for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}render({x:t,y:e,width:i=this.width,height:s=this.height,context:h=r()}){let n=this.frames[this._f]/this.spriteSheet._f|0,a=this.frames[this._f]%this.spriteSheet._f|0;h.drawImage(this.spriteSheet.image,a*this.width+(2*a+1)*this.margin,n*this.height+(2*n+1)*this.margin,this.width,this.height,t,e,i,s)}}function o(){return new a(...arguments)}let c=/^\//,d=/\/$/,l=new WeakMap,u="";function p(t,e){return new URL(t,e).href}let w={},f={};function m(t,e,i){return Math.min(Math.max(t,i),e)}class g{constructor(t=0,e=0,i={}){this.x=t,this.y=e,i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}add(t){return new g(this.x+t.x,this.y+t.y,this)}subtract(t){return new g(this.x-t.x,this.y-t.y,this)}scale(t){return new g(this.x*t,this.y*t)}normalize(t=this.length()){return new g(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}clamp(t,e,i,s){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?m(this._a,this._d,t):t}set y(t){this._y=this._c?m(this._b,this._e,t):t}}function x(){return new g(...arguments)}class _ extends class extends class{constructor(t){return this.init(t)}init(t={}){this.position=x(),this.velocity=x(),this.acceleration=x(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}{init({width:t=0,height:e=0,context:i=r(),render:s=this.draw,update:h=this.advance,children:n=[],anchor:a={x:0,y:0},opacity:o=1,rotation:c=0,scaleX:d=1,scaleY:l=1,...u}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:a,opacity:o,rotation:c,scaleX:d,scaleY:l,...u}),this._di=!0,this._uw(),this.addChild(n),this._rf=s,this._uf=h}update(t){this._uf(t),this.children.map((e=>e.update&&e.update(t)))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),1==this.scaleX&&1==this.scaleY||t.scale(this.scaleX,this.scaleY);let e=-this.width*this.anchor.x,i=-this.height*this.anchor.y;(e||i)&&t.translate(e,i),this.context.globalAlpha=this.opacity,this._rf(),(e||i)&&t.translate(-e,-i),this.children.map((t=>t.render&&t.render())),t.restore()}draw(){}_pc(){this._uw(),this.children.map((t=>t._pc()))}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:i=1,_wr:s=0,_wsx:h=1,_wsy:n=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=i*this.opacity,this._wsx=h*this.scaleX,this._wsy=n*this.scaleY,this._wx=this._wx*h,this._wy=this._wy*n,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=s+this.rotation;let{x:r,y:a}=function(t,e){let i=Math.sin(e),s=Math.cos(e);return{x:t.x*s-t.y*i,y:t.x*i+t.y*s}}({x:this._wx,y:this._wy},s);this._wx=r,this._wy=a,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...e){e.flat().map((e=>{this.children.push(e),e.parent=this,e._pc=e._pc||t,e._pc()}))}removeChild(...t){t.flat().map((t=>{(function(t,e){let i=t.indexOf(e);if(-1!=i)return t.splice(i,1),!0})(this.children,t)&&(t.parent=null,t._pc())}))}get opacity(){return this._opa}set opacity(t){this._opa=t,this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}{init({image:t,width:e=(t?t.width:void 0),height:i=(t?t.height:void 0),...s}={}){super.init({image:t,width:e,height:i,...s})}get animations(){return this._a}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){super.advance(t),this.currentAnimation&&this.currentAnimation.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function y(){return new _(...arguments)}function v(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}new WeakMap;let A=[],E={},k={},S={0:"south",1:"east",2:"west",3:"north",4:"leftshoulder",5:"rightshoulder",6:"lefttrigger",7:"righttrigger",8:"select",9:"start",10:"leftstick",11:"rightstick",12:"dpadup",13:"dpaddown",14:"dpadleft",15:"dpadright"};function b(t){A[t.gamepad.index]={pressedButtons:{},axes:{}}}function C(t){delete A[t.gamepad.index]}function L(){A.map((t=>{t.pressedButtons={},t.axes={}}))}function Y(){let t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];for(let e=0;e<t.length;e++){let i=t[e];if(!i)continue;i.buttons.map(((t,e)=>{let s=S[e],{pressed:h}=t,{pressedButtons:n}=A[i.index],r=n[s];!r&&h?[E[i.index],E].map((e=>{e?.[s]?.(i,t)})):r&&!h&&[k[i.index],k].map((e=>{e?.[s]?.(i,t)})),n[s]=h}));let{axes:s}=A[i.index];s.leftstickx=i.axes[0],s.leftsticky=i.axes[1],s.rightstickx=i.axes[2],s.rightsticky=i.axes[3]}}function M(t,{gamepad:e}={}){return isNaN(e)?A.some((e=>e.pressedButtons[t])):!!A[e]&&!!A[e].pressedButtons[t]}let R={},T={},X={},B={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function I(e=t,i){e._pd&&i.preventDefault(),e(i)}function z(t){let e=B[t.code],i=R[e];X[e]=!0,I(i,t)}function D(t){let e=B[t.code],i=T[e];X[e]=!1,I(i,t)}function G(){X={}}function U(t){return!!X[t]}function P(t){if(+t==t)return t;let e=[],i=t.split(".."),s=+i[0],h=+i[1],n=s;if(s<h)for(;n<=h;n++)e.push(n);else for(;n>=h;n--)e.push(n);return e}class W{constructor({image:t,frameWidth:e,frameHeight:i,frameMargin:s,animations:h}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:e,height:i,margin:s},this._f=t.width/e|0,this.createAnimations(h)}createAnimations(t){let e,i;for(i in t){let{frames:s,frameRate:h,loop:n}=t[i];if(e=[],null==s)throw Error("Animation "+i+" must provide a frames property");[].concat(s).map((t=>{e=e.concat(P(t))})),this.animations[i]=o({spriteSheet:this,frames:e,frameRate:h,loop:n})}}}function q(){return new W(...arguments)}class F{constructor(t,e,i,s){this.x1=t,this.x2=t+i,this.y1=e,this.y2=e+s,this.width=i,this.height=s}}const N=[new class{constructor(t,e,i){this.name=t,this.size=e,this.map=this.setUpMap(i)}setUpMap(t){const e=[];return t.forEach((t=>{e.push(new F(t[0],t[1],t[2],t[3]))})),e}draw(t){t.width=this.size,t.height=this.size;const e=t.getContext("2d");this.map.forEach((t=>{e.rect(t.x1,t.y1,t.width,t.height)})),e.fillStyle="white",e.fill()}}(1,128,[[0,6,117,10],[110,6,10,52],[77,48,33,10],[77,34,10,14],[77,34,29,10],[96,20,10,15],[65,20,31,10],[62,20,10,51],[62,63,58,10],[110,63,10,44],[68,97,42,10],[5,113,123,10],[5,19,10,94],[5,19,21,10],[20,19,10,87],[20,97,41,10],[51,80,10,10],[51,84,10,23],[59,80,51,10],[48,16,10,52],[34,58,15,10],[34,19,10,76]])];class j{constructor(t){this.canvas=t,this.context=t.getContext("2d")}clear(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}draw(t){this.context.drawImage(t.image,t.x,t.y)}drawText(t){this.context.font=t.font,this.context.fillStyle=t.color;let e=this.context.measureText(t.text).width,i=t.x-e/2;this.context.fillText(t.text,i,t.y)}drawYouLooseText(){let t=this.canvas.height/12+"px Arial",e=this.canvas.width/2,i=this.canvas.height/2;this.drawText({text:"Life was never for you...",font:t,color:"white",x:e,y:i})}}class H{constructor(){this.previousTime=(new Date).getTime()/1e3,this.timeElapsed=0}tick(){let t=(new Date).getTime()/1e3;return 0!=Math.floor(t-this.previousTime)&&(this.timeElapsed++,this.previousTime=t,!0)}}let{canvas:O}=function(t,{contextless:s=!1}={}){if(e=document.getElementById(t)||t||document.querySelector("canvas"),s&&(e=e||new Proxy({},n)),!e)throw Error("You must provide a canvas element for the game");return i=e.getContext("2d")||new Proxy({},n),i.imageSmoothingEnabled=!1,h("init"),{canvas:e,context:i}}();var K,$;u="./../assets/images",function(){let t;for(t=0;t<26;t++)B["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;t<10;t++)B["Digit"+t]=B["Numpad"+t]=""+t;window.addEventListener("keydown",z),window.addEventListener("keyup",D),window.addEventListener("blur",G)}(),window.addEventListener("gamepadconnected",b),window.addEventListener("gamepaddisconnected",C),window.addEventListener("blur",L),$=Y,s[K="tick"]=s[K]||[],s[K].push($);const J=new j(document.getElementById("background")),Q=new j(document.getElementById("foreground"));N[0].draw(J.canvas),O.width=N[0].size,O.height=N[0].size,O.style.backgroundColor="rgba(0, 0, 0, 0)";let V=y({x:0,y:0,color:"black",opacity:.4,width:O.width,height:O.height,dx:0,opacityChange:.02});var Z;(Z="wisp.png",window.__k||(window.__k={dm:l,u:p,d:f,i:w}),new Promise(((t,e)=>{let i,s,n;if(i=function(t,e){return[t.replace(d,""),t?e.replace(c,""):e].filter((t=>t)).join("/")}(u,Z),w[i])return t(w[i]);s=new Image,s.onload=function(){n=p(i,window.location.href),w[function(t){let e=t.replace("."+function(t){return t.split(".").pop()}(t),"");return 2==e.split("/").length?e.replace(c,""):e}(Z)]=w[i]=w[n]=this,h("assetLoaded",this,Z),t(this)},s.onerror=function(){e("Unable to load image "+i)},s.src=i}))).then((e=>{let i=y({x:40,y:5,rad:4,animations:q({image:e,frameWidth:16,frameHeight:16,animations:{idle:{frames:"0..3",frameRate:5}}}).animations,speed:1,getPosition:function(){return{x:this.x+8,y:this.y+8}}});i.playAnimation("idle");const s=new H;let n=!1,a=function({fps:e=60,clearCanvas:i=!0,update:s=t,render:n,context:a=r(),blur:o=!1}={}){if(!n)throw Error("You must provide a render() function");let c,d,l,u,p,w=0,f=1e3/e,m=1/e,g=i?v:t,x=!0;function _(){if(d=requestAnimationFrame(_),x&&(l=performance.now(),u=l-c,c=l,!(u>1e3))){for(h("tick"),w+=u;w>=f;)p.update(m),w-=f;g(a),p.render()}}return o||(window.addEventListener("focus",(()=>{x=!0})),window.addEventListener("blur",(()=>{x=!1}))),p={update:s,render:n,isStopped:!0,start(){c=performance.now(),this.isStopped=!1,requestAnimationFrame(_)},stop(){this.isStopped=!0,cancelAnimationFrame(d)},_frame:_,set _last(t){c=t}},p}({update:function(){s.tick()&&(V.opacity+=.12,10==s.timeElapsed&&(n=!0)),function(t,e){const i=[0,0];(U(B.ArrowDown)||M("dpaddown"))&&(i[1]+=1),(U(B.ArrowUp)||M("dpadup"))&&(i[1]-=1),(U(B.ArrowLeft)||M("dpadleft"))&&(i[0]-=1),(U(B.ArrowRight)||M("dpadright"))&&(i[0]+=1),function(t,e,i){const s=t.getPosition(),h=s.x+e[0],n=s.y+e[1];for(let t=0;t<i.length;t++)if(h>=i[t].x1&&h<=i[t].x2&&n>=i[t].y1&&n<=i[t].y2)return!0;return!1}(t,i,e)&&function(t,e){t.x+=e[0],t.y+=e[1]}(t,i)}(i,N[0].map),V.update(),i.update()},render:function(){n?(J.clear(),Q.drawYouLooseText()):(V.render(),i.render())}});a.start()}))})();