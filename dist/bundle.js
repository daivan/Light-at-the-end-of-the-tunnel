(()=>{"use strict";let t=()=>{};let i,e,s={};function h(t,...i){(s[t]||[]).map((t=>t(...i)))}let n={get:(i,e)=>"_proxy"==e||t};function r(){return e}class a{constructor({spriteSheet:t,frames:i,frameRate:e,loop:s=!0}){this.spriteSheet=t,this.frames=i,this.frameRate=e,this.loop=s;let{width:h,height:n,margin:r=0}=t.frame;this.width=h,this.height=n,this.margin=r,this._f=0,this._a=0}clone(){return new a(this)}reset(){this._f=0,this._a=0}update(t=1/60){if(this.loop||this._f!=this.frames.length-1)for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}render({x:t,y:i,width:e=this.width,height:s=this.height,context:h=r()}){let n=this.frames[this._f]/this.spriteSheet._f|0,a=this.frames[this._f]%this.spriteSheet._f|0;h.drawImage(this.spriteSheet.image,a*this.width+(2*a+1)*this.margin,n*this.height+(2*n+1)*this.margin,this.width,this.height,t,i,e,s)}}function o(){return new a(...arguments)}let c=/^\//,d=/\/$/,l=new WeakMap,u="";function p(t,i){return new URL(t,i).href}let w={},g={};function f(t,i,e){return Math.min(Math.max(t,e),i)}class m{constructor(t=0,i=0,e={}){this.x=t,this.y=i,e._c&&(this.clamp(e._a,e._b,e._d,e._e),this.x=t,this.y=i)}add(t){return new m(this.x+t.x,this.y+t.y,this)}subtract(t){return new m(this.x-t.x,this.y-t.y,this)}scale(t){return new m(this.x*t,this.y*t)}normalize(t=this.length()){return new m(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}clamp(t,i,e,s){this._c=!0,this._a=t,this._b=i,this._d=e,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?f(this._a,this._d,t):t}set y(t){this._y=this._c?f(this._b,this._e,t):t}}function _(){return new m(...arguments)}class x extends class extends class{constructor(t){return this.init(t)}init(t={}){this.position=_(),this.velocity=_(),this.acceleration=_(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let i=this.acceleration;t&&(i=i.scale(t)),this.velocity=this.velocity.add(i);let e=this.velocity;t&&(e=e.scale(t)),this.position=this.position.add(e),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}{init({width:t=0,height:i=0,context:e=r(),render:s=this.draw,update:h=this.advance,children:n=[],anchor:a={x:0,y:0},opacity:o=1,rotation:c=0,scaleX:d=1,scaleY:l=1,...u}={}){this._c=[],super.init({width:t,height:i,context:e,anchor:a,opacity:o,rotation:c,scaleX:d,scaleY:l,...u}),this._di=!0,this._uw(),this.addChild(n),this._rf=s,this._uf=h}update(t){this._uf(t),this.children.map((i=>i.update&&i.update(t)))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),1==this.scaleX&&1==this.scaleY||t.scale(this.scaleX,this.scaleY);let i=-this.width*this.anchor.x,e=-this.height*this.anchor.y;(i||e)&&t.translate(i,e),this.context.globalAlpha=this.opacity,this._rf(),(i||e)&&t.translate(-i,-e),this.children.map((t=>t.render&&t.render())),t.restore()}draw(){}_pc(){this._uw(),this.children.map((t=>t._pc()))}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:i=0,_wo:e=1,_wr:s=0,_wsx:h=1,_wsy:n=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=e*this.opacity,this._wsx=h*this.scaleX,this._wsy=n*this.scaleY,this._wx=this._wx*h,this._wy=this._wy*n,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=s+this.rotation;let{x:r,y:a}=function(t,i){let e=Math.sin(i),s=Math.cos(i);return{x:t.x*s-t.y*e,y:t.x*e+t.y*s}}({x:this._wx,y:this._wy},s);this._wx=r,this._wy=a,this._wx+=t,this._wy+=i}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...i){i.flat().map((i=>{this.children.push(i),i.parent=this,i._pc=i._pc||t,i._pc()}))}removeChild(...t){t.flat().map((t=>{(function(t,i){let e=t.indexOf(i);if(-1!=e)return t.splice(e,1),!0})(this.children,t)&&(t.parent=null,t._pc())}))}get opacity(){return this._opa}set opacity(t){this._opa=t,this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,i=t){this.scaleX=t,this.scaleY=i}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}{init({image:t,width:i=(t?t.width:void 0),height:e=(t?t.height:void 0),...s}={}){super.init({image:t,width:i,height:e,...s})}get animations(){return this._a}set animations(t){let i,e;for(i in this._a={},t)this._a[i]=t[i].clone(),e=e||this._a[i];this.currentAnimation=e,this.width=this.width||e.width,this.height=this.height||e.height}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){super.advance(t),this.currentAnimation&&this.currentAnimation.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function y(){return new x(...arguments)}function v(t){let i=t.canvas;t.clearRect(0,0,i.width,i.height)}new WeakMap;let A=[],b={},S={},C={0:"south",1:"east",2:"west",3:"north",4:"leftshoulder",5:"rightshoulder",6:"lefttrigger",7:"righttrigger",8:"select",9:"start",10:"leftstick",11:"rightstick",12:"dpadup",13:"dpaddown",14:"dpadleft",15:"dpadright"};function k(t){A[t.gamepad.index]={pressedButtons:{},axes:{}}}function E(t){delete A[t.gamepad.index]}function M(){A.map((t=>{t.pressedButtons={},t.axes={}}))}function R(){let t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];for(let i=0;i<t.length;i++){let e=t[i];if(!e)continue;e.buttons.map(((t,i)=>{let s=C[i],{pressed:h}=t,{pressedButtons:n}=A[e.index],r=n[s];!r&&h?[b[e.index],b].map((i=>{i?.[s]?.(e,t)})):r&&!h&&[S[e.index],S].map((i=>{i?.[s]?.(e,t)})),n[s]=h}));let{axes:s}=A[e.index];s.leftstickx=e.axes[0],s.leftsticky=e.axes[1],s.rightstickx=e.axes[2],s.rightsticky=e.axes[3]}}function L(t,{gamepad:i}={}){return isNaN(i)?A.some((i=>i.pressedButtons[t])):!!A[i]&&!!A[i].pressedButtons[t]}let Y={},X={},B={},D={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function G(i=t,e){i._pd&&e.preventDefault(),i(e)}function I(t){let i=D[t.code],e=Y[i];B[i]=!0,G(e,t)}function U(t){let i=D[t.code],e=X[i];B[i]=!1,G(e,t)}function P(){B={}}function z(t){return!!B[t]}function W(t){if(+t==t)return t;let i=[],e=t.split(".."),s=+e[0],h=+e[1],n=s;if(s<h)for(;n<=h;n++)i.push(n);else for(;n>=h;n--)i.push(n);return i}class q{constructor({image:t,frameWidth:i,frameHeight:e,frameMargin:s,animations:h}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:i,height:e,margin:s},this._f=t.width/i|0,this.createAnimations(h)}createAnimations(t){let i,e;for(e in t){let{frames:s,frameRate:h,loop:n}=t[e];if(i=[],null==s)throw Error("Animation "+e+" must provide a frames property");[].concat(s).map((t=>{i=i.concat(W(t))})),this.animations[e]=o({spriteSheet:this,frames:i,frameRate:h,loop:n})}}}function F(){return new q(...arguments)}class N{constructor(t,i,e,s){this.x1=t,this.x2=t+e,this.y1=i,this.y2=i+s,this.width=e,this.height=s}}const T=[new class{constructor(t,i,e){this.name=t,this.size=i,this.map=this.setUpMap(e)}setUpMap(t){const i=[];return t.forEach((t=>{i.push(new N(t[0],t[1],t[2],t[3]))})),i}}("level1",128,[[0,6,117,10],[110,6,10,52],[77,48,33,10],[77,34,10,14],[77,34,29,10],[96,20,10,15],[65,20,31,10],[62,20,10,51],[62,63,58,10],[110,63,10,44],[68,97,42,10],[5,113,123,10],[5,19,10,94],[5,19,21,10],[20,19,10,87],[20,97,41,10],[51,80,10,10],[51,84,10,23],[59,80,51,10],[48,16,10,52],[34,58,15,10],[34,19,10,76]])];let{canvas:j}=function(t,{contextless:s=!1}={}){if(i=document.getElementById(t)||t||document.querySelector("canvas"),s&&(i=i||new Proxy({},n)),!i)throw Error("You must provide a canvas element for the game");return e=i.getContext("2d")||new Proxy({},n),e.imageSmoothingEnabled=!1,h("init"),{canvas:i,context:e}}();var H,O;u="./../assets/images",function(){let t;for(t=0;t<26;t++)D["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;t<10;t++)D["Digit"+t]=D["Numpad"+t]=""+t;window.addEventListener("keydown",I),window.addEventListener("keyup",U),window.addEventListener("blur",P)}(),window.addEventListener("gamepadconnected",k),window.addEventListener("gamepaddisconnected",E),window.addEventListener("blur",M),O=R,s[H="tick"]=s[H]||[],s[H].push(O),function(t,i){const e=t.getContext("2d");console.log(i),i.forEach((t=>{e.rect(t.x1,t.y1,t.width,t.height)})),e.fillStyle="white",e.fill()}(document.getElementById("background"),T[0].map),j.width=T[0].size,j.height=T[0].size,j.style.backgroundColor="rgba(0, 0, 0, 0)";let K=y({x:0,y:0,color:"black",opacity:.4,width:j.width,height:j.height,dx:0,opacityChange:.02});var $;($="wisp.png",window.__k||(window.__k={dm:l,u:p,d:g,i:w}),new Promise(((t,i)=>{let e,s,n;if(e=function(t,i){return[t.replace(d,""),t?i.replace(c,""):i].filter((t=>t)).join("/")}(u,$),w[e])return t(w[e]);s=new Image,s.onload=function(){n=p(e,window.location.href),w[function(t){let i=t.replace("."+function(t){return t.split(".").pop()}(t),"");return 2==i.split("/").length?i.replace(c,""):i}($)]=w[e]=w[n]=this,h("assetLoaded",this,$),t(this)},s.onerror=function(){i("Unable to load image "+e)},s.src=e}))).then((i=>{let e=y({x:40,y:5,rad:4,animations:F({image:i,frameWidth:16,frameHeight:16,animations:{idle:{frames:"0..3",frameRate:5}}}).animations,speed:1,getPosition:function(){return{x:this.x+8,y:this.y+8}}});e.playAnimation("idle");let s=(new Date).getTime()/1e3,n=0,a=!1,o=function({fps:i=60,clearCanvas:e=!0,update:s=t,render:n,context:a=r(),blur:o=!1}={}){if(!n)throw Error("You must provide a render() function");let c,d,l,u,p,w=0,g=1e3/i,f=1/i,m=e?v:t,_=!0;function x(){if(d=requestAnimationFrame(x),_&&(l=performance.now(),u=l-c,c=l,!(u>1e3))){for(h("tick"),w+=u;w>=g;)p.update(f),w-=g;m(a),p.render()}}return o||(window.addEventListener("focus",(()=>{_=!0})),window.addEventListener("blur",(()=>{_=!1}))),p={update:s,render:n,isStopped:!0,start(){c=performance.now(),this.isStopped=!1,requestAnimationFrame(x)},stop(){this.isStopped=!0,cancelAnimationFrame(d)},_frame:x,set _last(t){c=t}},p}({update:function(){let t=(new Date).getTime()/1e3;0!=Math.floor(t-s)&&(s=t,n++,n<=30&&(K.opacity+=K.opacityChange),35==n&&(a=!0)),function(t,i){const e=[0,0];(z(D.ArrowDown)||L("dpaddown"))&&(e[1]+=1),(z(D.ArrowUp)||L("dpadup"))&&(e[1]-=1),(z(D.ArrowLeft)||L("dpadleft"))&&(e[0]-=1),(z(D.ArrowRight)||L("dpadright"))&&(e[0]+=1),function(t,i,e){const s=t.getPosition(),h=s.x+i[0],n=s.y+i[1];for(let t=0;t<e.length;t++)if(h>=e[t].x1&&h<=e[t].x2&&n>=e[t].y1&&n<=e[t].y2)return!0;return!1}(t,e,i)&&function(t,i){t.x+=i[0],t.y+=i[1]}(t,e)}(e,T[0].map),K.update(),e.update()},render:function(){a?(bgContext.fillStyle="white",bgContext.fillRect(0,0,j.width,j.height),bgContext.font="5px Arial",bgContext.fillStyle="black",bgContext.fillText("Stage Clear",j.width/2-100,j.height/2)):(K.render(),e.render())}});o.start()}))})();